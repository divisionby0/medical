var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},BUY_ONLINE_BUTTON_CLICKED="BUY_ONLINE_BUTTON_CLICKED",EmailSender=function(){function t(){this.$j=jQuery.noConflict()}return t.prototype.sendApplicationResult=function(t,e,n){var i=this,a=this.createApplicationResultData(t,e,n);this.$j.post(ajaxurl,a,function(t){return i.onComplete(t)})},t.prototype.sendApplicationAdminEmail=function(t){var e=this,n={action:"sendApplicationAdminEmail",appId:t};this.$j.post(ajaxurl,n,function(t){return e.onApplicationAdminEmailSent(t)})},t.prototype.createApplicationResultData=function(t,e,n){return{action:"sendApplicationResultEmail",receiver:t,body:e,appId:n}},t.prototype.onComplete=function(t){EventBus.dispatchEvent("APPLICATION_EMAIL_SENT_RESULT",t)},t.prototype.onApplicationAdminEmailSent=function(t){EventBus.dispatchEvent("APPLICATION_ADMIN_EMAIL_SENT_RESULT",t)},t}(),Emails=function(){function t(){this.noMedicalIssuesEmailText='<p><b>Thank you for your order!</b></p><p>Please find your application attached.</p><p><a href="applicationHtmlUrlString" target="_blank">applicationHtmlUrlString</a></p><p>Please check your application to ensure that the information you provided to us is correct. You will also receive an email soon with your Visitors to Canada Insurance Policy from the insurance company. If you need to make any changes to your application, or have any questions related to your order, email us at: <a href="mailto:CustomerSupport@InsureYourStay.ca">CustomerSupport@InsureYourStay.ca</a></p>',this.medicalIssuesEmailText='<p><b>Thank you for your application!</b></p><p>Please find your application attached.</p><p><a href="applicationHtmlUrlString" target="_blank">applicationHtmlUrlString</a></p><p>Please check your application to ensure that the information you provided to us is correct.</p><p style="color: #a60021;"><b>Important:</b></p><p style="color: #a60021;"><b>Next Step to Complete Your Application</b></p><p>You selected that you had a medical condition you wished to have covered... Please send an email to us explaining the nature of your medical condition. Include your phone number and the best time of day to contact you, and we will call you to complete your application and process your payment. If you need to make any changes to your application, or have any questions related to your order, please include them in your email. Email us at: <a href="mailto:CustomerSupport@InsureYourStay.ca">CustomerSupport@InsureYourStay.ca</a></p>'}return t.prototype.composeNoMedicalIssuesEmailText=function(t){return this.noMedicalIssuesEmailText.replace(/applicationHtmlUrlString/g,t)},t.prototype.composeMedicalIssuesEmailText=function(t){return this.medicalIssuesEmailText.replace(/applicationHtmlUrlString/g,t)},t}(),ApplicationType=function(){function t(){}return t.HAS_MEDICAL_ISSUES="MEDICAL_ISSUES",t.NORMAL="NORMAL",t}(),HTMLExporter=function(){function t(){this.$j=jQuery.noConflict()}return t.prototype.export=function(t,e){var n=this,i=this.createApplicationResultData(t,e);this.$j.post(ajaxurl,i,function(t){return n.onComplete(t)})},t.prototype.createApplicationResultData=function(t,e){return{action:"saveApplicationHTML",appId:t,appContent:e}},t.prototype.onComplete=function(t){EventBus.dispatchEvent("HTML_EXPORT_COMPLETE",t)},t}(),PageMarkupResposabilityTS=function(){function t(){this.$j=jQuery.noConflict()}return t.prototype.removeResponsabilityMarkup=function(){this.$j("meta[width='device-width']").remove(),this.$j("meta[initial-scale='1.0']").remove()},t}(),BenefitsJsonDataParser=function(){return{parse:function(t){var e;try{e=JSON.parse(t)}catch(e){return void console.error("Benefits parse error. "+e+". Given string '"+t+"'")}for(var n=new Map("allBenefits"),i=new MapJsonDecoder,a=0;a<e.length;a++)for(var o=e[a],r=(i=new MapJsonDecoder(o)).decode().getIterator();r.hasNext();){var s=r.next();try{n.add(s,s)}catch(t){}}return n}}},GetCompaniesBenefitsDataJson=function(){return{execute:function(){return $("#allBenefits").text()}}},BenefitsKeysSorter=function(){function t(t,e){return t-e}return{sort:function(e){var n,i=new Array;for(n=0;n<e.length;n++)i.push(parseInt(e[n]));return i.sort(t),i}}},Card=function(){function t(t,e,n,i){void 0===t&&(t=""),void 0===e&&(e=""),void 0===n&&(n=""),void 0===i&&(i=""),this.cardNumber=t,this.holderName=e,this.expDate=n,this.type=i}return t.prototype.getNumber=function(){return this.cardNumber},t.prototype.setNumber=function(t){this.cardNumber=t},t.prototype.getHolderName=function(){return this.holderName},t.prototype.setHolderName=function(t){this.holderName=t},t.prototype.getExpDate=function(){return this.expDate},t.prototype.setExpDate=function(t){this.expDate=t},t.prototype.getType=function(){return this.type},t.prototype.setType=function(t){this.type=t},t}(),Persons=function(){function t(t,e){return t-e}var e;return{setCollection:function(t){e=t},findByAge:function(t){for(var n=e.getIterator();n.hasNext();){var i=n.next();if(i.getAge()==t)return i}},getIterator:function(){return e.getIterator()},getAges:function(){for(var n=new Array,i=e.getIterator();i.hasNext();){var a=i.next().getAge();n.push(a)}return n.sort(t),n}}},QuoteId=function(){function t(t){this.$j=jQuery.noConflict(),this.cookieValue=t,this.decorateQuoteIdWithCurrentDate()}return t.prototype.decorateQuoteIdWithCurrentDate=function(){var t=new Date,e=(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()),n=t.getMinutes(),i=t.getSeconds();this.id=DateUtils.getCurrentDate()+"__"+e+"-"+n+"-"+i},t.prototype.getTempValue=function(){return this.cookieValue},t.prototype.getId=function(){return this.id},t}(),Person=function(){var t,e,n,i,a;return{create:function(o,r,s,c,u){t=o,e=r,n=s,i=c,a=u},getId:function(){return t},getAge:function(){return e},getBenefit:function(){return n},getUseSCCC:function(){return i},getTotalDays:function(){return a}}},PersonCollectionAgesParser=function(){function t(t,e){return t-e}return{parse:function(e){for(var n=new Array,i=e.getIterator();i.hasNext();){var a=i.next().getAge();n.push(a)}return n.sort(t),n}}}(),FamilyRateDetector={detect:function(t,e){var n=e.getAges();return n.sort(),n.length>=companyFamilyRateMinNumPersons&&n[n.length-1]<=t}},GetFormData=function(){var t=jQuery.noConflict();return{init:function(){var e=t("#formData");return JSON.parse(e.text())}}},FormDataParser=function(){function t(t){return"string"==typeof t||t instanceof String?(t=t.replace(/\\"/g,'"'),JSON.parse(t)):t}function e(t){return parseInt(t)}function n(t){return parseInt(t)}function i(t){return"Yes"==t?1:0}return{parse:function(a){var o;try{o=a.startDate.date}catch(t){return}var r=a.finishDate.date,s=(new Date(o),new Date(r),t(a.ages));a.ages=s;var c=i(a.useSccc);a.useSccc=c;var u=e(a.benefit);a.benefit=u;var p=n(a.numPersons);return a.numPersons=p,a}}},CreatePersons=function(){function t(t){var o,r=t.length;for(o=0;o<r;o++){var s=t[o],c=new Person;c.create(o,s,e,i,n),a.add(o,c)}}var e,n,i,a=new Map("persons");return{create:function(o){e=o.benefit,i=o.useSccc,n=o.totalDays,t(o.ages);var r=new Persons;return r.setCollection(a),r}}},CountriesSelect=function(){function t(){n=i("#countriesSelect")}function e(){var t=i("<option value='null' selected='selected'>Select country</option>");n.prepend(t),t.prop("disabled",!0)}var n,i=jQuery.noConflict();return{init:function(){t(),e()}}},SelectionForm=function(){function t(t,e,n,i){this.selectedItem=1,this.$j=jQuery.noConflict(),this.inputElementId=e,this.inputElement=this.getInputElement(),this.formId=n,this.form=this.getFormElement(),this.tableId=i,this.table=this.getTableElement(),this.addListener(),t&&(this.selectedItem=t,this.updateSelectedIndexByValue(this.selectedItem),this.selectedIndex+=1),this.selectItem(this.selectedIndex),this.updateInput()}return t.prototype.submit=function(){this.$j("#"+this.formId).submit()},t.prototype.getSelection=function(){return this.selectedItem},t.prototype.getInputElement=function(){return this.$j("#"+this.inputElementId)},t.prototype.getFormElement=function(){return this.$j("#"+this.formId)},t.prototype.getTableElement=function(){return this.$j("#"+this.tableId)},t.prototype.updateInput=function(){this.inputElement.val(this.selectedItem)},t.prototype.selectItem=function(t){var e=this.$j("#"+this.tableId+" > tbody  > tr").eq(t);this.selectedItem=e.attr("id"),e.addClass("itemSelected"),this.selectedRow=e},t.prototype.updateSelectedIndexByValue=function(t){var e=this;this.selectedIndex=-1,this.$j("#"+this.tableId+" > tbody  > tr").not(":first").each(function(n,i){return e.findIndex(n,i,t)})},t.prototype.findIndex=function(t,e,n){var i=this.$j(e).attr("id");parseInt(i)==parseInt(n)&&(this.selectedIndex=t)},t.prototype.tableRowIterator=function(t,e){this.addListeners(e)},t.prototype.addListeners=function(t){var e=this;this.$j(t).hover(function(t){return e.onRowHoverIn(t)},function(t){return e.onRowHoverOut(t)}),this.$j(t).click(function(t){return e.onClick(t)})},t.prototype.onClick=function(t){var e=this.$j(t.target).parent(),n=e.attr("id");this.selectedItem=n,this.updateInput();try{this.selectedRow.removeClass("itemSelected")}catch(t){}this.selectedRow=e,this.submitForm(),e.addClass("itemSelected")},t.prototype.onRowHoverIn=function(t){this.$j(t.target).parent().addClass("itemHovered")},t.prototype.onRowHoverOut=function(t){this.$j(t.target).parent().removeClass("itemHovered")},t.prototype.addListener=function(){var t=this;this.$j("#"+this.tableId+" > tbody  > tr").not(":first").each(function(e,n){return t.tableRowIterator(e,n)})},t.prototype.submitForm=function(){},t}(),BenefitSelectionFormTS=function(t){function e(e,n,i,a){t.call(this,e,n,i,a)}return __extends(e,t),e.prototype.submitForm=function(){EventBus.dispatchEvent("BENEFIT_SELECTED",this.selectedItem)},e}(SelectionForm),SCCCParser=function(){return{parse:function(t){var e=new MapJsonDecoder(t).decode(),n=new SCCC;return n.create(e),n}}},DeductibleAmountOptionsParser=function(){return{parse:function(t){var e=new MapJsonDecoder(t).decode(),n=new DeductibleAmountOptions;return n.create(e),n}}},StandardRatesParser=function(){return{parse:function(t){var e=new MapJsonDecoder(t).decode(),n=new StandardRates;return n.create(e),n}}},RateTableGuideParser=function(){return{parse:function(t){for(var e=new MapJsonDecoder(t),n=e.decode(),i=n.getKeys(),a=0;a<i.length;a++){var o=i[a],r=n.get(o);if("string"==typeof r||r instanceof String){var s=(e=new MapJsonDecoder(r)).decode();n.update(o,s)}}var c=new RateTableGuide;return c.create(n),c}}},SCCC=function(){var t;return{create:function(e){t=e},getCost:function(e,n){var i=t.get(e.toString());return i?i.get(n.toString())/1e3:-1}}},StandardRates=function(){var t;return{create:function(e){t=e},getCost:function(e,n){var i=t.get(e.toString());return i?i.get(n.toString())/1e3:null}}},GetDefaultRateTableGuideDataOperation=function(){var t;return{setStrategy:function(e){t=e},execute:function(e,n,i){return t.getDeductibleAndTable(e,n,i)}}},GetMedicalDeclarationRequiredOperation=function(){var t;return{setStrategy:function(e){t=e},execute:function(e,n,i){return t.getMedicalDeclarationRequired(e,n,i)}}},MedicalDeclarationRequirementUpdater=function(){function t(t,e){this.persons=t,this.rateTableGuide=e}return t.prototype.update=function(){for(var t=this.persons.getIterator();t.hasNext();){var e=t.next(),n=e.getAge(),i=e.getIsUseSCCC(),a=this.rateTableGuide.isMedicalDeclarationRequired(n,i);e.setMedicalDeclarationRequired(a)}},t}(),AgeUnderDefaultStrategy=function(){this.getDeductibleAndTable=function(t){var e=t.getKeys()[0],n=t.get(e);return{deductible:n.get("deductible"),table:n.get("premiumTable")}}},AgeOverDefaultStrategy=function(){function t(t,e){var n=parseInt(t.get("ageFrom")),i=parseInt(t.get("ageTill")),a=!1;return e>=n&&e<=i&&(a=!0),!!a}return{getDeductibleAndTable:function(e,n,i){for(var a=-1,o="notAvailble",r=e.getIterator();r.hasNext();){var s=r.next();if(t(s,n)){a=s.get("deductible"),o=s.get("premiumTable");var c=s.get("scco");if(c==i||-1==c)return{deductible:a,table:o}}}},getMedicalDeclarationRequired:function(e,n,i){for(var a=e.getIterator();a.hasNext();){var o=a.next();if(t(o,n)){var r=o.get("scco");if(r==i||-1==r)return 1==o.get("mdr")}}}}},RateTableGuide=function(){function t(t,n){var i,a=new GetDefaultRateTableGuideDataOperation;return i=new AgeOverDefaultStrategy,a.setStrategy(i),a.execute(e,t,n)}var e;return{create:function(t){e=t},getDefaultData:function(e,n){return t(e,n)},isMedicalDeclarationRequired:function(t,n){var i=new GetMedicalDeclarationRequiredOperation,a=new AgeOverDefaultStrategy;return i.setStrategy(a),i.execute(e,t,n)}}},DeductibleAmountOptions=function(){function t(t,e,n){return parseInt(t)>=parseInt(e)&&parseInt(t)<=parseInt(n)}var e;return{create:function(t){e=t},getDeductibles:function(){for(var t=new Array,n=e.getIterator();n.hasNext();){var i=n.next();t.push(i.get("deductible"))}return t},getSurchargeOrDiscountProcent:function(n,i,a){for(var o=e.getIterator(),r=new List("procentsByDeductible");o.hasNext();){var s=o.next(),c=s.get("deductible"),u=s.get("aggregatePolicyLimit");if(t(a,s.get("ageFrom"),s.get("ageTill"))&&c==n&&(i==u||"any"==u)){var p=s.get("surchargeOrDiscount");r.add({deductible:c,procent:p,benefit:u})}}return r}}},UpdateCostByDeductibleAmountOption=function(){function t(t,e){for(var n=t.getKeys(),i=0;i<n.length;i++){var a=n[i],o=e+e/100*t.get(a);t.update(a,o)}return t}var e;return{setTable:function(t){e=t},update:function(n,i,a){new Map("costs");for(var o=e.getDeductibles(),r=new Map("companyCostsByBenefitAndAge"),s=0;s<o.length;s++)for(var c=o[s],u=e.getSurchargeOrDiscountProcent(c,n,i).getIterator();u.hasNext();){var p=u.next(),d=p.deductible,l=p.procent,h=p.benefit;if(h==n||"any"==h)try{r.add(d,l)}catch(t){}}return r=t(r,a)}}},CompaniesCostsCalculator=function(){return{execute:function(t,e,n,i){for(var a=e.getIterator();a.hasNext();){var o=a.next();o.setSelectedBenefit(n),o.setPeriod(i),o.calculateCosts(t)}}}},RemoveEmptyCosts=function(){return{execute:function(t){for(var e=t.getIterator();e.hasNext();){var n=e.next(),i=(n.getId(),n.getDeductiblesCosts());i&&0==i.size()&&(i=null)}}}},CreateTableDataProvider=function(){return{execute:function(t){for(var e=new List("tableDataProvider"),n=t.getIterator();n.hasNext();){var i=n.next(),a=i.getDeductiblesCosts();null!=a&&0!=a.size()&&e.add(i)}return e}}},SortCompaniesByZeroDeductibleCost=function(){function t(t,e){return t.zeroDeductible-e.zeroDeductible}function e(e){e.sort(t)}return{sort:function(t){for(var n=new Array,i=new List("companies"),a=t.getIterator();a.hasNext();){var o=(u=a.next()).getDeductiblesCosts();if(o&&0!=o.size()){var r=o.get("0");n.push({zeroDeductible:parseFloat(r).toFixed(2),companyId:u.getId()})}}e(n);for(var s=0;s<n.length;s++){var c=n[s].companyId,u=t.get(c);i.add(u)}return i}}},CompanyDeductibles=function(){function t(){for(var t=n.getKeys(),e=0;e<t.length;e++){var a=t[e];i.add(a,NaN)}}function e(t,e){if(i.has(t)){var n=i.get(t);isNaN(n)&&(n=0);var a=n+e;i.update(t,a)}}var n,i=new Map("deductiblesCosts");return{setCollection:function(e){n=e,t()},getCollection:function(){return n},getCosts:function(){return i},excludeUnavailableCosts:function(){for(var t=new Map("deductiblesCosts"),e=i.getKeys(),n=0;n<e.length;n++){var a=e[n],o=i.get(a);!isNaN(o)&&o>0&&t.add(a,o)}i=t},updateCosts:function(t){if(t)for(var n=t.getKeys(),i=0;i<n.length;i++){var a=n[i];e(a,t.get(a))}}}},CompanyDeductiblesParser=function(){return{parse:function(t){return new MapJsonDecoder(t).decode()}}},CompanyModel=function(){function t(t){var e=new RateTableGuideParser;D=e.parse(t)}function e(t){var e=new DeductibleAmountOptionsParser;E=e.parse(t)}function n(t){var e=new SCCCParser;b=e.parse(t)}function i(t){var e=new StandardRatesParser;I=e.parse(t)}function a(t){var e=new MapJsonDecoder(t);T=e.decode()}function o(t,e){return D.getDefaultData(t,e)}function r(t,e){(w=o(t,e))?(R=w.deductible,A=w.table):(console.error("Company "+C+" has no data for age "+t+"  and selected sccc "+e+"! Excluding."),h())}function s(t,e){Q&&(j=B.getCost(t,e))}function c(t){"standardRatesMap"==t?B=I:"scccMap"==t?B=b:(console.error("Company "+C+" no default table selected! tableName="+t+" Excluding."),h())}function u(){c($?P:A)}function p(){O=_.update(V,k,j)}function d(t){for(var e=O.getKeys(),n=0;n<e.length;n++){var i=e[n],a=O.get(i);a*=t,O.update(i,a)}}function l(t){k=t.getAge();var e=t.getIsUseSCCC();return r(k,e),u(),s(V,k),-1==j?(h(),null):(p(),d(U),O)}function h(){Q=!1}function f(t){return m(t)}function m(t){for(var e=t.getAges(),n=[],i=0;i<e.length;i++)n.push(parseInt(e[i]));return n.sort(function(t,e){return e-t}),[n[0]]}function v(t){for(var e=(M=f(t))[0],n=l(t.getPersonByAge(e.toString())),i=new Map("costs"),a=n.getKeys(),o=0;o<a.length;o++){var r=a[o],s=2*n.get(r);i.add(r,s)}H.updateCosts(i)}function g(t){for(var e=t.getIterator();e.hasNext();){var n=l(e.next());H.updateCosts(n)}}var y,C,D,N,E,b,I,S,P,T,x,w,A,B,R,k,j,O,_,$,L,F,M,V,U,H=new CompanyDeductibles,Q=!0;return{init:function(t,e){y=t,C=e,_=new UpdateCostByDeductibleAmountOption},setUrl:function(t){x=t},getUrl:function(){return x},setBenefitsText:function(t){L=t},setLimitationsText:function(t){F=t},getBenefitsText:function(){return L},getLimitationsText:function(){return F},setRateTableGuide:function(e){N=e,t(e)},getRateTableGuide:function(){return N},isMedicalDeclarationRequired:function(t,e){return D.isMedicalDeclarationRequired(t,e)},setDeductibleAmountOptions:function(t){e(t),_.setTable(E)},setSCCC:function(t){n(t)},setStandardRates:function(t){i(t)},setFamilyRateMaxAge:function(t){S=t},setFamilyRatePremiumTable:function(t){P=t},setBenefits:function(t){a(t)},setSelectedBenefit:function(t){V=t},setPeriod:function(t){U=t},setDeductibles:function(t){var e=new CompanyDeductiblesParser;H.setCollection(e.parse(t))},getDeductibles:function(){return H.getCollection()},getId:function(){return y},getName:function(){return C},calculateCosts:function(t){($=FamilyRateDetector.detect(S,t))?v(t):g(t),H.excludeUnavailableCosts()},getDeductiblesCosts:function(){return Q?H.getCosts():null},getIsFamilyRate:function(){return $},getIsFamilyRateAges:function(){return M}}},CompanyTableRowView=function(){function t(t){return r('<div class="fullwidth centered resultTableTextDataReadMore"><a id="readMoreLink" href="'+t+'">read more</a></div>')}function e(t,e){var i=r('<div class="buyButton centered" id="buyButton" data-companyId="'+t+'" data-companyName="'+e+'"><button type="button" class="btn btn-success">Order online</button></div>');return n(i),i}function n(t){t.on("click",i)}function i(){var t=r(this);a(t.attr("data-companyName"),t.attr("data-companyid"),t.attr("data-medicalDeclarationRequired"))}function a(t,e,n){EventBus.dispatchEvent(BUY_ONLINE_BUTTON_CLICKED,{name:t,id:e,medicalDeclarationRequired:n})}var o,r=jQuery.noConflict();return{create:function(n){var i,a=(o=n).getName(),s=o.getId(),c=o.getDeductiblesCosts(),u=o.getUrl(),p=o.getBenefitsText(),d=o.getLimitationsText(),l=o.getIsFamilyRate(),h=r('<tr class="resultTableRow companyTableRow" id="company_126" data-companyid="'+s+'" data-companyname="'+a+'">'),f=r('<td class="planTableColumn">');f.appendTo(h);var m=r('<div class="fullwidth centered colorRed companyName">');r('<a href="'+u+'" class="colorRed"><b>'+a+"</b></a>").appendTo(m),m.appendTo(f);var v=r('<table class="fullwidth planTable" id="planTable">');v.appendTo(f),r('<tr class="resultTableRow"><th class="fullwidth centered">Deductible</th><th class="fullwidth centered">Premium</th></tr>').appendTo(v);for(var g=c.getKeys(),y=0;y<g.length;y++){var C=g[y],D=c.get(C).toFixed(2);r('<tr class="resultTableRow companyBenefitAndCost"><td class="planTableItemRenderer benefit">$ '+C+'</td><td class="planTableItemRenderer benefitCost">$ '+D+"</td></tr>").appendTo(v)}l&&r('<div class="centered familyRateInfo">Family Rate</div>').appendTo(f),e(s,a).appendTo(f);var N=r('<td class="companyTableItemRenderer resultTableTextDataPositionRelative">'),E=r('<div class="companyTextData" id="limitationsText"><p>'+d+"</p></div>");i=t(u),E.appendTo(N),i.appendTo(N),N.appendTo(h);var b=r('<td class="companyTableItemRenderer resultTableTextDataPositionRelative">'),I=r('<div class="companyTextData" id="benefitsText"><p>'+p+"</p></div>");return i=t(u),I.appendTo(b),i.appendTo(b),b.appendTo(h),h}}},CompaniesTable=function(){function t(){c=new Map("companiesRowsElements"),p(".companyTableRow").each(function(){var t=p(this),e=t.data("companyid");c.add(e,t)})}function e(){p(".companyTableRow").each(function(){p(this).remove()})}function n(){for(var t=c.getIterator();t.hasNext();){var e=t.next(),n=(e.attr("id"),e.data("companyid")),i=e.data("companyname"),a=new CompanyModel;a.init(n,i),d.add(n,a),e.find(".companyTextData").each(function(){switch(p(this).attr("id")){case"benefitsText":a.setBenefitsText(p(this).html());break;case"limitationsText":a.setLimitationsText(p(this).html());break;case"rateTableGuideText":a.setRateTableGuide(p(this).text());break;case"scccText":a.setSCCC(p(this).text());break;case"standartRatesText":a.setStandardRates(p(this).text());break;case"deductibleAmountOptionsText":a.setDeductibleAmountOptions(p(this).text());break;case"benefitsCollection":a.setBenefits(p(this).text());break;case"deductiblesCollection":a.setDeductibles(p(this).text());break;case"familyRateMaxAgeText":a.setFamilyRateMaxAge(parseInt(p(this).text()));break;case"familyRatePremiumTable":a.setFamilyRatePremiumTable(p(this).text())}})}}function i(t){var e=u.get(t.getName());t.setUrl(e),(new CompanyTableRowView).create(t).appendTo(p("#companiesTable"))}function a(){EventBus.addEventListener("FAMILY_RATE_DETECTED",o)}function o(t){var e=t.ages;p("#familyRateInfo").show(),p("#familyRateInfo").text("Family rate. Ages: "+e)}function r(){var t=p("#urls").text(),e=JSON.parse(t);u=s(e)}function s(t){var e=new Map("urls");for(var n in t)e.add(n,t[n]);return e}var c,u,p=jQuery.noConflict(),d=new Map("companies");return{getData:function(){return a(),t(),n(),d},setData:function(t){u=new Map("urls"),r(),e();for(var n=t.getIterator();n.hasNext();)i(n.next())}}},AgeInputRow=function(){function t(){r('[id*="ageRow_"]').click(function(){n(r(this).attr("id")),r(this).data("rowstate")}),EventBus.addEventListener("SAVED_AGES_CHANGED",e)}function e(t){o=i(t.data),a()}function n(t){return t.substring(7,t.length)}function i(t){return"string"==typeof t||t instanceof String?(t=t.replace(/\\/g,""),JSON.parse(t)):t}function a(){for(var t=0;t<o.length;t++)r("#agesSelect_"+t).val(o[t])}var o,r=jQuery.noConflict();return{init:function(){t()}}},AgesSelection=function(){function t(t){e(t.data)}function e(t){n(t)}function n(t){for(var e=g.length-1;e>-1;e--){var n=D.get(g[e]);e<t?(n.removeClass("invisible"),p(e,C("#agesSelect_"+e).val())):(i(e),a(e),u(e),n.addClass("invisible"))}}function i(t){C("#agesSelect_"+t).val(0)}function a(t){C("#ageCalendarInput_"+t).val("")}function o(){C(".ageRow").each(function(t){var e=C(this).attr("id");s(e=e.replace("ageRow_",""),C(this))}),r()}function r(){g=D.getKeys()}function s(t,e){D.add(t,e)}function c(t){p(t.id,t.value)}function u(t){N.splice(t,1),h()}function p(t,e){N[t]=e,h()}function d(t){for(var e=l(t.data),n=0;n<e.length;n++)p(n,e[n])}function l(t){return"string"==typeof t||t instanceof String?(t=t.replace(/\\/g,""),JSON.parse(t)):t}function h(){y.val(JSON.stringify(N))}function f(){y=C("#ages")}function m(){C('select[id^="agesSelect_"]').each(function(t){C(this).on("change",function(){var e=t;p(e,C(this).val()),v(e)})})}function v(t){C("#ageCalendarInput_"+t).val("")}var g,y,C=jQuery.noConflict(),D=new Map("agesElements"),N=new Array;return{init:function(){f(),o(),n(1),h(),m(),EventBus.addEventListener("NUM_PERSONS_CHANGED",t),EventBus.addEventListener("ON_AGE_CHANGED",c),EventBus.addEventListener("SAVED_AGES_CHANGED",d)}}},UseSccc=function(){function t(){EventBus.addEventListener("SAVED_USE_SCCC_CHANGED",e)}function e(t){n(t.data)}function n(t){i("input[name=scccCovering][value="+t+"]").attr("checked","checked")}var i=jQuery.noConflict();return{init:function(){t()}}},NumPersons=function(){function t(t){e("#numPersonsSelect").val(t.data),EventBus.dispatchEvent("NUM_PERSONS_CHANGED",{data:t.data})}var e=jQuery.noConflict();return{init:function(){EventBus.addEventListener("SAVED_NUM_PERSONS_CHANGED",t),e("#numPersonsSelect").change(function(){EventBus.dispatchEvent("NUM_PERSONS_CHANGED",{data:e(this).val()})})}}},StartDateCalendar=function(){function t(t,e,n){a("#startDateMonth").val(e),a("#startDateYear").val(t),a("#startDateDay").val(n)}function e(e){var n=DateUtils.parseToArray(e);t(n[0],n[1],n[2])}function n(){EventBus.addEventListener("SAVED_START_DATE_CHANGED",i)}function i(t){var n=DateUtils.parseDate(t.data.date);a("#startDateCalendarContainer").val(n),e(n)}var a=jQuery.noConflict();return{init:function(){try{var t=DateUtils.getCurrentDate();a("#startDateCalendarContainer").val(t),a("#startDateCalendarContainer").datepicker({onSelect:function(t){e(t)},minDate:0,defaultDate:new Date}),e(DateUtils.getCurrentDate()),n()}catch(t){}}}},FinishDateCalendar=function(){function t(t,e,n){a("#finishDateMonth").val(e),a("#finishDateYear").val(t),a("#finishDateDay").val(n)}function e(e){var n=DateUtils.parseToArray(e);t(n[0],n[1],n[2])}function n(){EventBus.addEventListener("SAVED_FINISH_DATE_CHANGED",i)}function i(t){var n=DateUtils.parseDate(t.data.date);a("#finishDateCalendarContainer").val(n),e(n)}var a=jQuery.noConflict();return{init:function(){try{var t=DateUtils.getTomorrowDate(),i=new Date;i.setDate(i.getDate()+1),a("#finishDateCalendarContainer").val(t),a("#finishDateCalendarContainer").datepicker({onSelect:function(t){e(t)},minDate:1,defaultDate:i}),e(t),n()}catch(t){}}}},BenefitsSelectionForm=function(){function t(){r("#selectedBenefitInput").val(s)}function e(){Cookie.setBenefit(s),r("#benefitSelectionForm").submit()}function n(){r("#benefitsSelectionForm > tbody  > tr").not(":first").each(function(){r(this).hover(function(){r(this).addClass("itemHovered")},function(){r(this).removeClass("itemHovered")}),r(this).click(function(){var n=r(this).attr("id");if(n!=s){s=n,t();try{o.removeClass("itemSelected")}catch(t){}o=r(this)}r(this).addClass("itemSelected"),e()})})}function i(t){var e=r("#benefitsSelectionForm > tbody  > tr").eq(t);s=e.attr("id"),e.addClass("itemSelected"),o=e}function a(t){var e=-1;return r("#benefitsSelectionForm > tbody  > tr").not(":first").each(function(n){var i=r(this).attr("id");parseInt(i)==parseInt(t)&&(e=n)}),e}var o,r=jQuery.noConflict(),s=1;return{init:function(e){n();var o=1;e&&(o=a(s=e),o+=1),i(o),t()}}},CompanyPlanSelectionForm=function(t){function e(e,n,i,a){t.call(this,e,n,i,a)}return __extends(e,t),e.prototype.submitForm=function(){EventBus.dispatchEvent("COMPANY_PLAN_SELECTED",{deductible:this.selectedItem})},e}(SelectionForm),UserDataInputForm=function(){function t(){s=u("#benefitsSelect")}function e(){var t,e=new BenefitsKeysSorter;try{t=e.sort(r.getKeys())}catch(t){return}for(i=0;i<t.length;i++){var n=t[i],a=parseInt(r.get(n)),o=MoneyFormatter.format(a,2,":"," ");u('<option value="'+a+'">$'+o+"</option>").appendTo(s)}}function n(){if(Cookie.isEnabled()){var t=Cookie.getUserInputFormData();return t?(c=a(t),!0):(console.error("Error parsing cookie. "),!1)}return alert("Cookie disabled. This site need cookie to be enabled."),!1}function a(t){return StringUtils.parseURI(t)}function o(){if(c){var t=c.numPersons,e=c.ages,n=(c.benefit,c.startDate),i=c.finishDate,a=c.useSccc;EventBus.dispatchEvent("SAVED_NUM_PERSONS_CHANGED",{data:t}),EventBus.dispatchEvent("SAVED_AGES_CHANGED",{data:e}),EventBus.dispatchEvent("SAVED_START_DATE_CHANGED",{data:n}),EventBus.dispatchEvent("SAVED_FINISH_DATE_CHANGED",{data:i}),EventBus.dispatchEvent("SAVED_USE_SCCC_CHANGED",{data:a})}}var r,s,c,u=jQuery.noConflict();return{init:function(i){r=i,n();var a=null!=c||void 0!=c;t(),e(),a&&o()}}},ResultTableEmail=function(){function t(){return p("#emailInput").val()}function e(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}function n(){r.click(function(){if(e(u=t())){var n={action:"sendResultFormEmail",data:c,receiver:u};p.post(ajaxurl,n,function(t){i("complete"==JSON.parse(t).result?"Email sent":"Error sending email")})}else alert("Email address not valid.")})}function i(t){var e=p("<div>"+t+"</div>");e.dialog({modal:!0,buttons:[{text:"Ok",click:function(t){e.dialog("close")}}]})}function a(t,e){var n=new Array;return p("<table><tbody><tr><td>Deductible</td><td>Premium</td></tr></tbody>").appendTo(e),t.find(".companyBenefitAndCost").each(function(){var t=p(this),e=t.find(".benefit").text(),i=t.find(".benefitCost").text();n.push({benefit:e,cost:i})}),n}function o(){var t=p("#testTableContainer"),e=p("<div>");e.appendTo(t);var n=p('<table style="border-bottom: 1px solid #ddd;"><tbody><tr><td style="width: 200px; text-align: center;"><b>Plan</b></td><td style="width: 300px; text-align: center;"><b>Exclusions and Limitations</b></td><td style="width: 300px; text-align: center;"><b>Benefits</b></td></tr></tbody>');n.appendTo(e);var i=p(".userDataSelectionInfoContainer").text(),o=new Array;p(".companyTableRow").each(function(){var t=p(this),e=t.data("companyname"),i=t.find("#readMoreLink").attr("href"),r=p("<tr>"),s=p('<td style="width: 200px; text-align: center;"><b style="color: #bd070f">'+e+"</b></td>");s.appendTo(r),r.appendTo(n);var c=a(t,s),u=t.find("#benefitsText").html(),d=t.find("#limitationsText").html();o.push({name:e,url:i,plan:c,benefits:u,limitations:d})});var r={userDataInfo:i,companies:o};return r=JSON.stringify(r)}var r,s,c,u,p=jQuery.noConflict();return{init:function(){r=p("#sendEmailButton"),n(),c=o(),s=p("#resultPageContent").html()}}},BasePage=function(){function t(){this.$j=jQuery.noConflict()}return t.prototype.getPersons=function(){var t=Cookie.getPersons(),e=StringUtils.parseURI(t),n=new MapJsonDecoder(JSON.stringify(e)).decode();return this.parsePersons(n)},t.prototype.parsePersons=function(t){for(var e=new QuotePersonCollection,n=t.getIterator();n.hasNext();){var i=n.next(),a=i._age,o=i._firstName,r=i._lastName,s=i._gender,c=i._relationship,u=i._questions,p=i._birthday,d=i._complete,l=i._useSCCC,h=i._period,f=i._medicalDeclarationRequired,m=new QuotePerson(a,o,r,s,c,p,u);m.setIsComplete(d),m.setIsUseSCCC(l),m.setPeriod(h),m.setMedicalDeclarationRequired(f),e.add(m)}return e},t}(),PersonDetailsErrorView=function(){function t(t){this.container=t}return t.prototype.showAnswerError=function(){this.container.text("Error. You must answer YES at least the first question !"),this.container.removeClass("hidden")},t.prototype.showConfirmationError=function(){this.container.text("Error. You must confirm all data !"),this.container.removeClass("hidden")},t.prototype.destroy=function(){this.container.addClass("hidden"),this.container.text("")},t}(),PersonQuestionsView=function(){function t(t,e){this.hasAnsweredSavedQuestions=!1,this.$j=jQuery.noConflict(),this.person=t,this.companyId=e,this.createChildren()}return t.prototype.destroy=function(){this.$j("#questionsRootContainer").empty()},t.prototype.isValid=function(){return new PersonMedicalDeclarationAnswerValidator(this.userQuestionsView.getData()).validate()},t.prototype.getAnswers=function(){return this.person.getQuestions().getEncoder().encode()},t.prototype.createChildren=function(){this.$j("#personHeaderContainer").show(),this.$j("#confirmationHeaderContainer").hide(),this.$j("#personHeaderContainer").text(this.person.getFirstName()+"   "+this.person.getLastName()),this.$j("#firstNameContainer").text(this.person.getFirstName()),this.$j("#lastNameContainer").text(this.person.getLastName()),this.$j("#genderContainer").text(this.person.getGender()),this.$j("#dateOfBirthContainer").text(this.person.getBirthday()),this.$j("#ageContainer").text(this.person.getAge()),this.getQuestions()},t.prototype.getQuestions=function(){this.questionsIsLoaded()?this.createSavedQuestionsFrontend():this.loadQuestions()},t.prototype.onQuestionsLoadComplete=function(t){this.$j("#questionsPreloaderTextContainer").addClass("hidden");var e,n=new MapJsonDecoder(t).decode(),i=QuestionCollectionParser.parse(n,""),a=(e=this.person.getMedicalDeclarationRequired()?i:new QuestionCollectionCutter(i).getQuestionsBeforeFirstBoolean()).getEncoder().encode();this.userQuestionsView=new FrontendUserQuestions(a,"questionsRootContainer"),this.person.setQuestions(this.userQuestionsView.getData())},t.prototype.questionsIsLoaded=function(){return!this.$j.isEmptyObject(this.person.getQuestions())},t.prototype.loadQuestions=function(){var t=this;this.$j("#questionsPreloaderTextContainer").removeClass("hidden");var e={action:"loadQuestions",companyId:this.companyId};this.$j.post(ajaxurl,e,function(e){return t.onQuestionsLoadComplete(e)})},t.prototype.createSavedQuestionsFrontend=function(){var t=this.person.getQuestions().getEncoder().encode();this.userQuestionsView=new FrontendUserQuestions(t,"questionsRootContainer"),this.person.setQuestions(this.userQuestionsView.getData())},t}(),PersonConfirmationView=function(){function t(t){this.$j=jQuery.noConflict(),this.person=t,this.containerId="questionsRootContainer",this.createChildren()}return t.prototype.destroy=function(){this.$j("#"+this.containerId).empty()},t.prototype.isValid=function(){return this.confirmCheckBox.is(":checked")},t.prototype.createChildren=function(){this.$j("#personHeaderContainer").hide(),this.$j("#confirmationHeaderContainer").show(),this.createConfirmCheckBox(),this.updatePersonPrivateDetails(),this.$j("#"+this.containerId).append(this.checkBoxContainer)},t.prototype.createConfirmCheckBox=function(){this.confirmCheckBox=this.$j('<input type="checkbox" id="confirmCheckBox">  <label for="confirmCheckBox" class="text-success"> I confirm all this data !</label><br/>'),this.checkBoxContainer=this.$j("<div style='width:100%; text-align: center; display:inline-block; text-align: center;' id='cont'>").append(this.confirmCheckBox)},t.prototype.updatePersonPrivateDetails=function(){this.$j("#personHeaderContainer").text(this.person.getFirstName()+"   "+this.person.getLastName()),this.$j("#firstNameContainer").text(this.person.getFirstName()),this.$j("#lastNameContainer").text(this.person.getLastName()),this.$j("#genderContainer").text(this.person.getGender()),this.$j("#dateOfBirthContainer").text(this.person.getBirthday()),this.$j("#ageContainer").text(this.person.getAge())},t}(),PersonConfirmationAnswersView=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.prototype.createChildren=function(){var e=this.person.getQuestions();this.answers=e.getEncoder().encode(),this.loadAnswers(),t.prototype.createChildren.call(this)},e.prototype.loadAnswers=function(){this.answersView=new FrontendUserAnswers(this.answers,this.containerId)},e}(PersonConfirmationView),PersonMedicalDeclarationAnswerValidator=function(){function t(t){this.questions=t}return t.prototype.validate=function(){var t=new FirstRootQuestion(this.questions).getAnswer();return t&&t.getType()==ObjectType.BOOLEAN_ANSWER?"Yes"==t.getValue():(console.error("First sub question is not boolean."),!1)},t}(),PageFactory=function(){function t(){}return t.create=function(t){return"companiesTablePage"==t?new CompaniesByUserDataPageTS:"benefitsByUserDataAndZeroDeductiblePage"==t?new BenefitSelectionPage:"personDetailsPage"==t?new PersonDetailsPage:"cardDetailsPage"==t?new CardDetailsPage:"medicalIssuesSelectionPage"==t?new MedIssuesSelectionPage:"applicationCreationPage"==t?new ApplicationCreationPage:"applicationFinishPage"==t||"applicationFinishPageHasMedicalIssues"==t?new ApplicationFinishPage:"sendResultEmailPage"==t?new SendResultEmailPage:"companyPlanSelection"==t?new CompanyPlanSelectionPage:"simplePage"==t?new UserInputFormPage:"datePickerYearAndMonthOnlyTestingPage"==t?new DatePickerYearAndMonthOnlyTestingPage:"composeEmailTestingPage"==t?new ComposeEmailTestingPage:void 0},t}(),PersonalInfoRequestView=function(){function t(t){this.$j=jQuery.noConflict(),this.age=t.age,this.firstName=t.firstName,this.lastName=t.lastName,this.gender=t.gender,this.relationship=t.relationship,this.birthday=t.birthday,this.firstNameValid=!1,this.lastNameValid=!1,this.dateOfBirthValid=!1,this.relationshipValid=!1,this.dateOfBirth="",this.createChildren()}return t.prototype.validate=function(){this.firstName=this.firstNameInput.val(),this.lastName=this.lastNameInput.val(),this.gender=this.genderSelect.val(),this.dateOfBirth=this.dateSelect.val(),this.firstNameValid=this.isFirstNameValid(),this.lastNameValid=this.isLastNameValid(),this.dateOfBirthValid=this.isBirthdayValid(),this.firstNameValid?this.lastNameValid?this.dateOfBirthValid||(EventBus.dispatchEvent("PERSONAL_INFO_BIRTHDAY_VALIDATE_ERROR",this.age),this.showDateOfBirthError()):(EventBus.dispatchEvent("PERSONAL_INFO_LAST_NAME_VALIDATE_ERROR",this.age),this.showLastNameError()):(EventBus.dispatchEvent("PERSONAL_INFO_FIRST_NAME_VALIDATE_ERROR",this.age),this.showFirstNameError())},t.prototype.isValid=function(){return this.validate(),!!(this.firstNameValid&&this.lastNameValid&&this.dateOfBirthValid)},t.prototype.dropError=function(){this.hideFirstNameError(),this.hideLastNameError(),this.hideDateOfBirthError()},t.prototype.getData=function(){return{age:this.age,firstName:this.firstName,lastName:this.lastName,gender:this.gender,birthday:this.dateOfBirth,relationship:this.$j("#relationship_"+this.age).val()}},t.prototype.createChildren=function(){var t=this;this.lastNameInput=this.$j("#lastname_"+this.age),this.firstNameInput=this.$j("#firstname_"+this.age),this.relationshipInput=this.$j("#relationship_"+this.age),this.firstNameErrorText=this.$j("#firstNameErrorText_"+this.age),this.lastNameErrorText=this.$j("#lastNameErrorText_"+this.age),this.dateOfBirthErrorText=this.$j("#dateOfBirthErrorText_"+this.age),this.genderSelect=this.$j("#genderSelect_"+this.age),this.dateSelect=this.$j("#dateOfBirthSelect_"+this.age),this.lastNameInput.keydown(function(){return t.lastNameChangedHandler()}),this.firstNameInput.keydown(function(){return t.firstNameChangedHandler()}),this.firstName&&this.firstNameInput.val(this.firstName),this.lastName&&this.lastNameInput.val(this.lastName),this.relationship&&this.relationshipInput.val(this.relationship),this.birthday&&this.dateSelect.val(this.birthday),this.createDateSelector()},t.prototype.createDateSelector=function(){var t=this;this.dateSelect.datepicker({maxDate:0,changeMonth:!0,changeYear:!0,yearRange:"-99:+0",defaultDate:new Date,onSelect:function(e){return t.dateOfBirthSelected(e)}})},t.prototype.isBirthdayValid=function(){var t=new TextLengthValidator(this.dateOfBirth).validate(1);return DateUtils.getYearsFromDate(this.dateOfBirth)==this.age&&t},t.prototype.isFirstNameValid=function(){return new TextLengthValidator(this.firstName).validate(1)},t.prototype.isLastNameValid=function(){return new TextLengthValidator(this.lastName).validate(1)},t.prototype.showFirstNameError=function(){this.$j("#firstNameRow_"+this.age).css("color","#a94442"),this.$j("#firstNameError_"+this.age).removeClass("hidden"),this.$j("#firstNameContainer_"+this.age).addClass("has-error has-feedback")},t.prototype.hideFirstNameError=function(){this.$j("#firstNameRow_"+this.age).css("color",""),this.$j("#firstNameError_"+this.age).addClass("hidden"),this.$j("#firstNameContainer_"+this.age).removeClass("has-error has-feedback")},t.prototype.showLastNameError=function(){this.$j("#lastNameRow_"+this.age).css("color","#a94442"),this.$j("#lastNameError_"+this.age).removeClass("hidden"),this.$j("#lastNameContainer_"+this.age).addClass("has-error has-feedback")},t.prototype.hideLastNameError=function(){this.$j("#lastNameRow_"+this.age).css("color",""),this.$j("#lastNameError_"+this.age).addClass("hidden"),this.$j("#lastNameContainer_"+this.age).removeClass("has-error has-feedback")},t.prototype.showDateOfBirthError=function(){this.$j("#birthdayRow_"+this.age).css("color","#a94442"),this.$j("#birthdayError_"+this.age).removeClass("hidden"),this.$j("#birthdayContainer_"+this.age).addClass("has-error has-feedback"),this.$j("#dateOfBirthSelect_"+this.age).val("").attr("placeholder","Empty or not "+this.age+" y.o.").addClass("dateInputError_webkit").addClass("dateInputError_moz").addClass("dateInputError_moz_2").addClass("dateInputError_ms")},t.prototype.hideDateOfBirthError=function(){this.$j("#birthdayRow_"+this.age).css("color",""),this.$j("#birthdayError_"+this.age).addClass("hidden"),this.$j("#birthdayContainer_"+this.age).removeClass("has-error has-feedback"),this.$j("#dateOfBirthSelect_"+this.age).attr("placeholder","Click to pick date of birth").removeClass("dateInputError_webkit").removeClass("dateInputError_moz").removeClass("dateInputError_moz_2").removeClass("dateInputError_ms")},t.prototype.lastNameChangedHandler=function(){this.hideLastNameError(),this.dispatchValueChanged()},t.prototype.firstNameChangedHandler=function(){this.hideFirstNameError(),this.dispatchValueChanged()},t.prototype.dateOfBirthSelected=function(t){this.hideDateOfBirthError(),this.dispatchValueChanged()},t.prototype.dispatchValueChanged=function(){EventBus.dispatchEvent("PERSONAL_INFO_VALUE_CHANGED",null)},t}(),CompaniesByUserDataPageTS=function(t){function e(){t.call(this),this.prevPage="benefits-by-user-data-and-zero-deductible",this.period=Cookie.getPeriod()}return __extends(e,t),e.prototype.create=function(){var t=this;EventBus.addEventListener("BUY_ONLINE_BUTTON_CLICKED",function(e){return t.onBuyOnlineButtonClickedHandler(e)}),(new PageMarkupResposabilityTS).removeResponsabilityMarkup(),this.companiesTable=new CompaniesTable,this.companies=this.companiesTable.getData();var e=(new GetFormData).init(),n=new FormDataParser;this.parsedFormData=n.parse(e);try{this.selectedBenefit=this.parsedFormData.benefit}catch(t){return}this.persons=this.getPersons(),(new CompaniesCostsCalculator).execute(this.persons,this.companies,this.selectedBenefit,this.period),(new RemoveEmptyCosts).execute(this.companies);var i=(new SortCompaniesByZeroDeductibleCost).sort(this.companies),a=(new CreateTableDataProvider).execute(i);this.companiesTable.setData(a),(new ResultTableEmail).init(),this.prevButton=this.$j("#prevButton"),this.prevButton.on("click",function(){return t.prevButtonClickHandler()})},e.prototype.prevButtonClickHandler=function(){this.navigateToPrevPage()},e.prototype.navigateToPrevPage=function(){NavigatorUtil.navigateTo(this.prevPage)},e.prototype.onBuyOnlineButtonClickedHandler=function(t){var e={companyName:t.name,companyId:t.id,medicalDeclarationRequired:t.medicalDeclarationRequired,benefit:this.selectedBenefit,deductiblesCosts:null};if(this.selectedCompany=this.companies.get(t.id),this.selectedCompany){var n=this.selectedCompany.getDeductiblesCosts();e.deductiblesCosts=n.getEncoder().encode()}else console.error("selected company not defined");this.saveSelectedCompany(e),this.navigateToPlanSelectionPage()},e.prototype.saveSelectedCompany=function(t){var e=JSON.stringify(t);Cookie.setSelectedCompanyData(e)},e.prototype.navigateToPlanSelectionPage=function(){NavigatorUtil.navigateTo("plan-selection")},e}(BasePage),PersonDetailsPage=function(t){function e(){t.call(this),this.prevPage="application-creation",this.nextPage="/medicalissusselectionpage",this.QUESTIONS="QUESTIONS",this.CONFIRMATION="CONFIRMATION",this.COMPLETE="COMPLETE",this.PREV_PAGE_REQUESTED="PREV_PAGE_REQUESTED",this.answerInvalidErrorType="answerInvalid",this.confirmationInvalidErrorType="confirmationInvalid"}return __extends(e,t),e.prototype.create=function(){this.companyData=this.getCompany(),this.parseCompany(this.companyData),this.persons=this.getPersons(),this.currentPerson=this.getUncompletePerson(),this.onCurrentPersonChanged(),this.createNavigationListeners()},e.prototype.onCurrentPersonChanged=function(){void 0===this.currentPerson?(this.savePersonsData(),this.navigateTo(this.nextPage)):(this.currentState=this.QUESTIONS,this.onStateChanged())},e.prototype.savePersonsData=function(){var t=Cookie.getQuoteId(),e=this.persons.getData(),n=escape(e);DB.savePersons(n,t)},e.prototype.getUncompletePerson=function(){for(var t=this.persons.getIterator();t.hasNext();){var e=t.next();if(!e.getIsComplete())return e}},e.prototype.onStateChanged=function(){this.currentState==this.QUESTIONS?this.showQuestions():this.currentState==this.CONFIRMATION&&this.showConfirmation()},e.prototype.showQuestions=function(){this.questionsView=new PersonQuestionsView(this.currentPerson,this.companyId)},e.prototype.hideQuestions=function(){this.questionsView&&this.questionsView.destroy()},e.prototype.showConfirmation=function(){this.confirmationView=new PersonConfirmationAnswersView(this.currentPerson)},e.prototype.hideConfirmation=function(){this.confirmationView&&this.confirmationView.destroy()},e.prototype.createNavigationListeners=function(){var t=this;this.$j("#nextButton").click(function(){return t.onNextButtonClick()}),this.$j("#prevButton").click(function(){return t.onPrevButtonClick()})},e.prototype.onNextButtonClick=function(){this.hideError(),this.currentState==this.QUESTIONS?this.questionsView.isValid()?this.onQuestionsAnswerValid():this.showError(this.answerInvalidErrorType):this.currentState==this.CONFIRMATION&&(this.confirmationView.isValid()?this.onAnswersConfirmed():this.showError(this.confirmationInvalidErrorType))},e.prototype.onPrevButtonClick=function(){var t=this.persons.getIterator();new NavigateToPrevPageDetector(t).detect(this.currentState)?this.navigateTo(this.prevPage):this.prevPerson()},e.prototype.prevPerson=function(){this.dropCompleteForEachPerson(),this.hideConfirmation(),this.hideQuestions(),this.hideError(),this.currentPerson=this.getUncompletePerson(),this.onCurrentPersonChanged()},e.prototype.dropCompleteForEachPerson=function(){for(var t=this.persons.getIterator();t.hasNext();)t.next().setIsComplete(!1)},e.prototype.onQuestionsAnswerValid=function(){this.hideQuestions(),this.currentState=this.CONFIRMATION,this.onStateChanged()},e.prototype.onAnswersConfirmed=function(){this.hideConfirmation(),this.currentPerson.setIsComplete(!0),this.currentPerson=this.getUncompletePerson(),this.onCurrentPersonChanged()},e.prototype.navigateTo=function(t){"/medicalissusselectionpage"==t&&(this.$j("#confirmationHeaderContainer").text("Please wait..."),this.$j("#personDetailsContainer").hide(),this.$j("#nextButton").hide(),this.$j("#prevButton").hide()),NavigatorUtil.navigateTo(t)},e.prototype.getCompany=function(){var t=Cookie.getSelectedCompanyData();return StringUtils.parseURI(t)},e.prototype.parseCompany=function(t){this.companyId=t.companyId},e.prototype.hideError=function(){this.errorView&&this.errorView.destroy()},e.prototype.showError=function(t){this.errorView=new PersonDetailsErrorView(this.$j("#userPersonalDataErrorText")),"answerInvalid"==t?this.errorView.showAnswerError():"confirmationInvalid"==t&&this.errorView.showConfirmationError()},e}(BasePage),CardDetailsConfirmationView=function(){function t(t){this.$j=jQuery.noConflict(),this.card=t,this.checkBox=this.$j("#confirmCheckBox"),this.update(),this.uncheckCheckBox()}return t.prototype.update=function(){this.$j("#cardTypeConfirmation").text(this.card.getType()),this.$j("#cardNumberConfirmation").text(this.card.getNumber()),this.$j("#cardholderConfirmation").text(this.card.getHolderName()),this.$j("#cardExpConfirmation").text(this.card.getExpDate())},t.prototype.destroy=function(){this.$j("#cardTypeConfirmation").text(""),this.$j("#cardNumberConfirmation").text(""),this.$j("#cardholderConfirmation").text(""),this.$j("#cardExpConfirmation").text(""),this.uncheckCheckBox()},t.prototype.isConfirmed=function(){return this.checkBox.is(":checked")},t.prototype.uncheckCheckBox=function(){this.checkBox.prop("checked",!1)},t}(),SaveApplication=function(){return function(t,e,n,i){this.$j=jQuery.noConflict(),this.companyData=t,this.quoteId=e,this.personsData=n,this.persons=i;var a=new QuoteSaver,o=Cookie.getPeriod(),r=Cookie.getCompanyPlan(),s=StringUtils.parseURI(r),c=Cookie.getUserInputFormData(),u=StringUtils.parseURI(c),p=u.startDate.date,d=u.finishDate.date;p=p.split("+")[0],d=d.split("+")[0];var l=JSON.stringify({company:this.companyData.companyName,benefit:this.companyData.benefit,period:o,deductible:s.deductible,cost:s.cost,startDate:p,finishDate:d}),h=this.persons.size(),f=Cookie.getCountryOfOrigin(),m=Cookie.getVisitorType(),v=Cookie.getArrivalDate(),g=Cookie.getSponsorFirstName(),y=Cookie.getSponsorLastName(),C=Cookie.getBeneficiaryFirstName(),D=Cookie.getBeneficiaryLastName(),N=Cookie.getAddress(),E=Cookie.getSponsorCity(),b=Cookie.getSponsorProvince(),I=Cookie.getSponsorPostalCode(),S=Cookie.getEmail(),P=Cookie.getPhone(),T=Cookie.getApplicationType();T||(T=ApplicationType.HAS_MEDICAL_ISSUES),this.quoteDataToSave={quoteId:this.quoteId.getId(),companyName:this.companyData.companyName,quoteData:l,persons:this.personsData,period:o,numPersons:h,startDate:p,finishDate:d,countryOfOrigin:f,visitorType:m,arrivalDate:v,sponsorFirstName:g,sponsorLastName:y,beneficiaryFirstName:C,beneficiaryLastName:D,address:N,city:E,province:b,postalCode:I,email:S,phone:P,type:T,state:"IN_PROGRESS"},this.$j("#quoteData").val(JSON.stringify(this.quoteDataToSave)),a.save(this.quoteDataToSave)}}(),MedIssuesSelectionPage=function(t){function e(){t.call(this),this.prevPage="person-details",this.nextPage="finish-application",this.nextPageHasMedicalIssues="finish-application-has-medical-issues"}return __extends(e,t),e.prototype.create=function(){this.finishButton=this.$j("#finishButton"),this.prevButton=this.$j("#prevButton"),this.payNowButton=this.$j(".wspsc_add_cart_submit"),this.cartCheckoutButton=this.$j(".wspsc_add_cart_submit"),this.createButtonsListener(),this.createRadioGroupListener(),this.updateApplicationType("NORMAL"),this.updateApplicationIdContainer(),this.updatePayPalCostInput()},e.prototype.loadQuotePersonsData=function(){var t=this;EventBus.addEventListener("personsDataLoadComplete",function(e){return t.personsDataLoadComplete(e)}),DB.loadPersons(this.quoteId.getTempValue())},e.prototype.personsDataLoadComplete=function(t){var e=this;EventBus.removeEventListener("personsDataLoadComplete",function(t){return e.personsDataLoadComplete(t)}),this.onPersonDataLoadComplete(t)},e.prototype.onPersonDataLoadComplete=function(t){this.validatePersonsLoadedData(t)?(this.personsData=t,this.onPersonsDataValid()):console.error("persons loaded data not valid. data: "+t)},e.prototype.onPersonsDataValid=function(){this.createPayNowButtonListener(),this.createCartCheckoutButtonListener()},e.prototype.saveApplication=function(){new SaveApplication(this.companyData,this.quoteId,this.personsData,this.persons)},e.prototype.createRadioGroupListener=function(){var t=this;this.$j("input[type=radio][name=medIssuesRadioGroup]").change(function(e){return t.onRadioGroupChanged(e)})},e.prototype.onRadioGroupChanged=function(t){this.selectedOption=parseInt(this.$j(t.target).val()),this.onOptionChanged()},e.prototype.onOptionChanged=function(){0==this.selectedOption?(this.finishButton.hide(),this.$j("#paypalButtonContainer").show(),this.updateApplicationType(ApplicationType.NORMAL)):(this.finishButton.show(),this.$j("#paypalButtonContainer").hide(),this.finishButton.text("Finish"),this.updateApplicationType(ApplicationType.HAS_MEDICAL_ISSUES))},e.prototype.createButtonsListener=function(){var t=this;this.finishButton.click(function(){return t.onFinishButtonClick()}),this.prevButton.click(function(){return t.onPrevButtonClick()})},e.prototype.onFinishButtonClick=function(){1==this.selectedOption&&this.navigateToNextPage()},e.prototype.onPrevButtonClick=function(){this.navigateToPrevPage()},e.prototype.navigateToPrevPage=function(){NavigatorUtil.navigateTo(this.prevPage)},e.prototype.navigateToNextPage=function(){NavigatorUtil.navigateTo(this.nextPageHasMedicalIssues)},e.prototype.updateApplicationIdContainer=function(){this.$j("#applicationIdContainer").text(Cookie.getQuoteId())},e.prototype.getCompany=function(){var t=Cookie.getSelectedCompanyData();return StringUtils.parseURI(t)},e.prototype.updateApplicationType=function(t){Cookie.setApplicationType(t)},e.prototype.validatePersonsLoadedData=function(t){var e=unescape(t);try{JSON.parse(e);return!0}catch(t){return!1}},e.prototype.createPayNowButtonListener=function(){var t=this;this.payNowButton.click(function(e){return t.onPayNowButtonClicked(e)})},e.prototype.onPayNowButtonClicked=function(t){this.saveApplication()},e.prototype.createCartCheckoutButtonListener=function(){this.cartCheckoutButton.unbind("click").attr("onclick","").each(function(){this.onclick=null})},e.prototype.updatePayPalCostInput=function(){var t=this.$j("input[name='totalPremiumValueInput']").val();this.$j("input[name='price']").val(t)},e}(BasePage),CardDetailsPage=function(){function t(){this.cardIdMinCharacters=15,this.cardIdMaxCharacters=16,this.prevPage="person-details",this.NORMAL="NORMAL",this.CONFIRMATION="CONFIRMATION",this.CONFIRMED="CONFIRMED",this.$j=jQuery.noConflict(),this.card=new Card,this.card.setType("mastercard"),this.currentState=this.NORMAL}return t.prototype.create=function(){this.cardTypeSelect=this.$j("#cardTypeSelect"),this.cardHolderInput=this.$j("#cardholderNameInput"),this.cardExpirationDateInput=this.$j("#expirationDateInput"),this.cardNumberInput=this.$j("#cardNumberInput"),this.nextButton=this.$j("#nextButton"),this.prevButton=this.$j("#prevButton"),this.errorContainer=this.$j("#errorText"),this.confirmationContainer=this.$j("#confirmationViewContainer"),this.form=this.$j("#cardDetailsForm"),""!=this.cardExpirationDateInput.val()&&this.card.setExpDate(this.cardExpirationDateInput.val()),this.card.setType("mastercard"),this.createCardTypeSelectListener(),this.createCardNumberInputListener(),this.createDateSelector(),this.createButtonsListener()},t.prototype.onStateChanged=function(){this.currentState==this.NORMAL?(this.hideConfirmation(),this.showForm()):this.currentState==this.CONFIRMATION?(this.hideForm(),this.showConfirmation()):this.navigateToNextPage()},t.prototype.showConfirmation=function(){this.$j("#confirmationViewContainer").removeClass("hidden"),this.confirmationView=new CardDetailsConfirmationView(this.card)},t.prototype.hideConfirmation=function(){this.$j("#confirmationViewContainer").addClass("hidden"),this.confirmationView&&(this.confirmationView.destroy(),this.confirmationView=null)},t.prototype.onNextButtonClick=function(){this.hideError();this.currentState==this.NORMAL?(this.cardHolderName=this.cardHolderInput.val(),this.cardExpirationDate=this.cardExpirationDateInput.val(),this.cardNumber=this.cardNumberInput.val(),this.card.setNumber(this.cardNumber),this.card.setHolderName(this.cardHolderName),this.validate()&&(this.currentState=this.CONFIRMATION,this.onStateChanged())):this.currentState==this.CONFIRMATION&&this.validate()&&(this.currentState=this.CONFIRMED,this.onStateChanged())},t.prototype.onPrevButtonClick=function(){this.currentState==this.CONFIRMATION?(this.currentState=this.NORMAL,this.onStateChanged()):this.currentState==this.NORMAL&&this.navigateToPrevPage()},t.prototype.hideError=function(){this.errorContainer.text(""),this.errorContainer.addClass("hidden")},t.prototype.showError=function(t){this.errorContainer.text(t),this.errorContainer.removeClass("hidden")},t.prototype.navigateToNextPage=function(){this.form.submit()},t.prototype.navigateToPrevPage=function(){NavigatorUtil.navigateTo(this.prevPage)},t.prototype.onExpirationDateSelected=function(t){this.cardExpirationDate=this.cardExpirationDateInput.val(),this.card.setExpDate(this.cardExpirationDate)},t.prototype.createButtonsListener=function(){var t=this;this.nextButton.click(function(){return t.onNextButtonClick()}),this.prevButton.click(function(){return t.onPrevButtonClick()})},t.prototype.validate=function(){return this.currentState==this.NORMAL?this.validateInfo():this.currentState==this.CONFIRMATION?this.validateConfirmation():void 0},t.prototype.validateInfo=function(){var t=!0;this.cardHolderName.length<3&&(this.showError("Card holder name invalid"),t=!1);var e=parseInt(this.cardNumberInput.attr("maxlength"));return e!=this.cardNumber.length&&(this.showError("Card number invalid"),t=!1),e!=this.cardNumber.length&&(this.showError("Card number invalid"),t=!1),this.cardExpirationDate.length<1&&(this.showError("Card expiration date invalid"),t=!1),t},t.prototype.validateConfirmation=function(){var t=this.confirmationView.isConfirmed();return 0==t&&this.showError("Error. You must confirm card details."),t},t.prototype.clearCardIdInput=function(){this.cardNumberInput.val("")},t.prototype.createCardNumberInputListener=function(){var t=this;this.cardNumberInput.keypress(function(e){return t.onCardNumberChanged(e)})},t.prototype.onCardNumberChanged=function(t){if(8!=t.which&&0!=t.which&&(t.which<48||t.which>57))return this.onCardNumberError(),!1},t.prototype.createCardTypeSelectListener=function(){var t=this;this.cardTypeSelect.change(function(){return t.onCardTypeSelectChanged()})},t.prototype.onCardTypeSelectChanged=function(){switch(this.cardType=this.cardTypeSelect.val(),this.card.setType(this.cardType),this.$j("#cardTypeFormData").val(this.cardType),this.clearCardIdInput(),this.cardType){case"mastercard":case"visa":this.cardNumberInput.attr("maxlength",this.cardIdMaxCharacters);break;case"americanExpress":this.cardNumberInput.attr("maxlength",this.cardIdMinCharacters)}},t.prototype.createDateSelector=function(){var t=this;this.cardExpirationDateInput.datepicker({minDate:0,changeMonth:!0,changeYear:!0,yearRange:"-10:+10",dateFormat:"MM yy",defaultDate:new Date,showButtonPanel:!0,onSelect:function(e){return t.onExpirationDateSelected(e)},onClose:function(e,n){return t.onCloseDatepicker(e,n)}});this.cardExpirationDateInput.click(function(){return t.onDateClicked()}),this.cardExpirationDateInput.focus(function(){return t.onDateClicked()})},t.prototype.onCloseDatepicker=function(t,e){var n=this.$j("#ui-datepicker-div .ui-datepicker-month :selected").val(),i=this.$j("#ui-datepicker-div .ui-datepicker-year :selected").val();this.cardExpirationDateInput.val(this.$j.datepicker.formatDate("MM yy",new Date(i,n,1))),this.cardExpirationDate=this.cardExpirationDateInput.val(),this.card.setExpDate(this.cardExpirationDate)},t.prototype.onDateClicked=function(){this.$j("table.ui-datepicker-calendar").eq(2).prop("style","display: none;"),this.$j("table.ui-datepicker-calendar").hide(),this.$j("#ui-datepicker-div").position({my:"center top",at:"center bottom",of:this.cardExpirationDateInput})},t.prototype.hideForm=function(){this.form.addClass("hidden")},t.prototype.showForm=function(){this.form.removeClass("hidden")},t.prototype.onCardNumberError=function(){this.$j("#errmsg").html("Digits Only").show().fadeOut("slow")},t}(),NavigateToPrevPageDetector=function(){function t(t){this.personsIterator=t}return t.prototype.detect=function(t){for(;this.personsIterator.hasNext();)if(this.personsIterator.next().getIsComplete())return!1;return"CONFIRMATION"!=t},t}(),UserInputFormPage=function(){function t(){return Math.round(999999*Math.random())}jQuery.noConflict();return{create:function(e){var n=(new BenefitsJsonDataParser).parse(e);(new AgesSelection).init(),(new AgeInputRow).init(),(new NumPersons).init(),(new StartDateCalendar).init(),(new FinishDateCalendar).init(),(new CountriesSelect).init(),(new UseSccc).init(),(new UserDataInputForm).init(n);var i=t();Cookie.setQuoteId(i)}}},BenefitSelectionPage=function(){function t(){o=new QuotePersonCollection;for(var t=0;t<r.ages.length;t++){var e=r.ages[t],n=new QuotePerson(e);n.setIsUseSCCC(s),n.setPeriod(r.totalDays),0==t&&n.setRelationship(PRIMARY),o.add(n)}}function e(){var t=o.getData();Cookie.setPersons(t)}function n(){var t=r.totalDays;Cookie.setPeriod(t)}function i(t){Cookie.setBenefit(t),u.submit()}function a(){NavigatorUtil.navigateTo(d)}var o,r,s,c,u,p,d,l=jQuery.noConflict();return{create:function(){EventBus.addEventListener("BENEFIT_SELECTED",i);var o=Cookie.getUserInputFormData();(r=StringUtils.parseURI(o))||(r={benefit:null}),c=r.benefit,s="Yes"==r.useSccc,t(),e(),n(),u=new BenefitSelectionFormTS(c,"selectedBenefitInput","benefitSelectionForm","benefitsSelectionTable"),d=l("#baseUrl").text(),(p=l("#prevButton")).click(function(){a()})}}},CompanyPlanSelectionPage=function(){function t(){this.prevPage="companies-by-user-data",this.nextPage="/application-creation",this.$j=jQuery.noConflict()}return t.prototype.create=function(){var t=this,e=this.getCompany(),n=new MapJsonDecoder(e.deductiblesCosts);this.companyCosts=n.decode(),this.createCostSelectionForm(),this.prevButton=this.$j("#prevButton"),this.prevButton.on("click",function(){return t.prevButtonClickHandler()}),EventBus.addEventListener("COMPANY_PLAN_SELECTED",function(e){return t.companyPlanSelectedHandler(e)})},t.prototype.navigateToNextPage=function(){NavigatorUtil.navigateTo(this.nextPage)},t.prototype.navigateToPrevPage=function(){NavigatorUtil.navigateTo(this.prevPage)},t.prototype.prevButtonClickHandler=function(){this.navigateToPrevPage()},t.prototype.getCompany=function(){var t=Cookie.getSelectedCompanyData();return StringUtils.parseURI(t)},t.prototype.saveSelectedPlan=function(t,e){Cookie.setCompanyPlan(JSON.stringify({deductible:t,cost:e}))},t.prototype.createCostSelectionForm=function(){var t=Cookie.getCompanyPlan(),e=StringUtils.parseURI(t),n=-1;e&&(n=e.deductible);new CompanyPlanSelectionForm(n,"selectedPlanInput","planSelectionForm","planSelectionTable")},t.prototype.companyPlanSelectedHandler=function(t){var e=t.deductible,n=this.companyCosts.get(e);this.saveSelectedPlan(e,n),this.navigateToNextPage()},t}(),PersonsAdditionalDataRequestView=function(){function t(){this.$j=jQuery.noConflict(),this.createChildren(),this.createListeners(),this.savedCountryOfOrigin||this.saveCountryOfOrigin(),this.savedVisitorType||this.saveVisitorType(),this.savedProvince||this.saveProvince(),this.savedArrivalDate||(this.savedArrivalDate=this.arrivalDateControl.val(),this.saveArrivalDate(this.savedArrivalDate))}return t.prototype.validate=function(){var t,e=!0,n=this.arrivalDateControl.val(),i=(this.sponsorFirstNameControl.val(),this.sponsorLastNameControl.val(),this.addressControl.val()),a=this.cityControl.val(),o=this.postalCodeControl.val(),r=this.emailControl.val(),s=this.validateEmail(r),c=this.phoneControl.val(),u=this.validatePhone(c),p=PostalCodeValidator.validate(o);return(!n||n.length<3)&&(t="Arrival date invalid",e=!1),(!i||i.length<3)&&(t="Canadian address invalid",e=!1),(!a||a.length<3)&&(t="City invalid",e=!1),p||(t="Postal code invalid",e=!1),s||(t="Email invalid",e=!1),u||(t="Phone invalid",e=!1),{isValid:e,errorText:t}},t.prototype.loadData=function(){this.savedCountryOfOrigin=Cookie.getCountryOfOrigin(),this.savedVisitorType=Cookie.getVisitorType(),this.savedArrivalDate=Cookie.getArrivalDate(),this.savedSponsorFirstName=Cookie.getSponsorFirstName(),this.savedSponsorLastName=Cookie.getSponsorLastName(),this.savedBeneficiaryFirstName=Cookie.getBeneficiaryFirstName(),this.savedBeneficiaryRelationship=Cookie.getBeneficiaryLastName(),this.savedAddress=Cookie.getAddress(),this.savedProvince=Cookie.getSponsorProvince(),this.savedCity=Cookie.getSponsorCity(),this.savedPostalCode=Cookie.getSponsorPostalCode(),this.savedEmail=Cookie.getEmail(),this.savedPhone=Cookie.getPhone()},t.prototype.createChildren=function(){this.countryOfOriginControl=this.$j("#countriesSelect"),this.visitorTypeControl=this.$j("#visitorTypeSelect"),this.arrivalDateControl=this.$j("#arrivalDateInput"),this.sponsorFirstNameControl=this.$j("#sponsorFirstName"),this.sponsorLastNameControl=this.$j("#sponsorLastName"),this.beneficiaryFirstNameControl=this.$j("#beneficiaryFirstName"),this.beneficiaryRelationship=this.$j("#beneficiaryRelationship"),this.addressControl=this.$j("#streetInput"),this.cityControl=this.$j("#cityInput"),this.provinceControl=this.$j("#provinceSelect"),this.postalCodeControl=this.$j("#postalCodeSelect"),this.emailControl=this.$j("#emailInput"),this.phoneControl=this.$j("#phoneInput"),this.emailErrorMessageElement=this.$j("#emailErrorMessage"),this.phoneErrorMessageElement=this.$j("#phoneErrorMessage"),this.createArrivalDatePicker()},t.prototype.createArrivalDatePicker=function(){var t=this;this.arrivalDateControl.datepicker({changeYear:!0,yearRange:"-10:+10",defaultDate:new Date,onSelect:function(e){return t.onArrivalDateSelected(e)}})},t.prototype.updateControls=function(){this.savedCountryOfOrigin&&this.countryOfOriginControl.val(unescape(this.savedCountryOfOrigin)),this.savedVisitorType&&this.visitorTypeControl.val(unescape(this.savedVisitorType)),this.savedArrivalDate&&this.arrivalDateControl.val(this.savedArrivalDate),this.savedSponsorFirstName&&this.sponsorFirstNameControl.val(unescape(this.savedSponsorFirstName)),this.savedSponsorLastName&&this.sponsorLastNameControl.val(unescape(this.savedSponsorLastName)),this.savedBeneficiaryFirstName&&this.beneficiaryFirstNameControl.val(unescape(this.savedBeneficiaryFirstName)),this.savedBeneficiaryRelationship&&this.beneficiaryRelationship.val(unescape(this.savedBeneficiaryRelationship)),this.savedAddress&&this.addressControl.val(unescape(this.savedAddress)),this.savedProvince&&this.provinceControl.val(unescape(this.savedProvince)),this.savedEmail&&this.emailControl.val(unescape(this.savedEmail)),this.savedPhone&&this.phoneControl.val(unescape(this.savedPhone)),this.savedPostalCode&&this.postalCodeControl.val(unescape(this.savedPostalCode)),this.savedCity&&this.cityControl.val(unescape(this.savedCity))},t.prototype.onArrivalDateSelected=function(t){this.saveArrivalDate(t)},t.prototype.createListeners=function(){var t=this;this.countryOfOriginControl.change(function(){return t.countryOfOriginControlChanged()}),this.visitorTypeControl.change(function(){return t.visitorTypeControlChanged()}),this.sponsorFirstNameControl.keyup(function(e){return t.onSponsorFirstNameChanged(e)}),this.sponsorLastNameControl.keyup(function(e){return t.onSponsorLastNameChanged(e)}),this.beneficiaryFirstNameControl.keyup(function(e){return t.onBeneficiaryFirstNameChanged(e)}),this.beneficiaryRelationship.keyup(function(e){return t.onBeneficiaryRelationshipChanged(e)}),this.addressControl.keyup(function(e){return t.onAddressChanged(e)}),this.provinceControl.change(function(){return t.provinceControlChanged()}),this.cityControl.keyup(function(e){return t.cityChanged(e)}),this.postalCodeControl.keyup(function(e){return t.postalCodeChanged(e)}),this.emailControl.keyup(function(e){return t.onEmailChanged(e)}),this.phoneControl.keyup(function(e){return t.onPhoneChanged(e)})},t.prototype.countryOfOriginControlChanged=function(){this.saveCountryOfOrigin()},t.prototype.visitorTypeControlChanged=function(){this.saveVisitorType()},t.prototype.provinceControlChanged=function(){this.saveProvince()},t.prototype.saveCountryOfOrigin=function(){Cookie.setCountryOfOrigin(this.countryOfOriginControl.val())},t.prototype.saveVisitorType=function(){Cookie.setVisitorType(this.visitorTypeControl.val())},t.prototype.saveProvince=function(){Cookie.setSponsorProvince(this.provinceControl.val())},t.prototype.saveArrivalDate=function(t){Cookie.setArrivalDate(t)},t.prototype.onSponsorFirstNameChanged=function(t){Cookie.setSponsorFirstName(this.sponsorFirstNameControl.val())},t.prototype.onSponsorLastNameChanged=function(t){Cookie.setSponsorLastName(this.sponsorLastNameControl.val())},t.prototype.onBeneficiaryFirstNameChanged=function(t){Cookie.setBeneficiaryFirstName(this.beneficiaryFirstNameControl.val())},t.prototype.onBeneficiaryRelationshipChanged=function(t){Cookie.setBeneficiaryLastName(this.beneficiaryRelationship.val())},t.prototype.onAddressChanged=function(t){Cookie.setAddress(this.addressControl.val())},t.prototype.onEmailChanged=function(t){var e=this.emailControl.val();this.validateEmail(e)&&Cookie.setEmail(e)},t.prototype.onPhoneChanged=function(t){var e=this.phoneControl.val();this.validatePhone(e)&&Cookie.setPhone(e)},t.prototype.cityChanged=function(t){Cookie.setSponsorCity(this.cityControl.val())},t.prototype.postalCodeChanged=function(t){Cookie.setSponsorPostalCode(this.postalCodeControl.val())},t.prototype.validateEmail=function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},t.prototype.validatePhone=function(t){return/^\d+$/.test(t)},t.prototype.validatePostalCode=function(t){return PostalCodeValidator.validate(t)},t}(),ApplicationCreationPage=function(t){function e(){t.call(this),this.prevPage="plan-selection",this.nextPage="person-details"}return __extends(e,t),e.prototype.create=function(){var t=this;this.views=new Map("personViews"),this.ages=this.getAges(),this.persons=this.getPersons(),this.updatePersonsMedicalDeclarationRequirements(),this.createChildren(),EventBus.addEventListener("PERSONAL_INFO_VALUE_CHANGED",function(){return t.personalInfoValueChangedHandler()}),EventBus.addEventListener("PERSONAL_INFO_FIRST_NAME_VALIDATE_ERROR",function(e){return t.personalInfoFirstNameValidateErrorHandler(e)}),EventBus.addEventListener("PERSONAL_INFO_LAST_NAME_VALIDATE_ERROR",function(e){return t.personalInfoLastNameValidateErrorHandler(e)}),EventBus.addEventListener("PERSONAL_INFO_BIRTHDAY_VALIDATE_ERROR",function(e){return t.personalInfoBirthdayValidateErrorHandler(e)})},e.prototype.getCompany=function(){var t=Cookie.getSelectedCompanyData();return StringUtils.parseURI(t)},e.prototype.getAges=function(){for(var t=this.$j("#agesCollectionContainer").text(),e=new Array,n=JSON.parse(t),i=0;i<n.length;i++){var a=n[i];e.push(a)}return e},e.prototype.createChildren=function(){var t=this;this.prevButton=this.$j("#prevButton"),this.nextButton=this.$j("#nextButton"),this.prevButton.on("click",function(){return t.prevButtonClickHandler()}),this.nextButton.on("click",function(){return t.nextButtonClickHandler()});for(var e=0;e<this.ages.length;e++){var n=this.persons.getPersonByAge(this.ages[e]),i={age:this.ages[e]};n&&(i.firstName=n.getFirstName(),i.lastName=n.getLastName(),i.gender=n.getGender(),i.relationship=n.getRelationship(),i.birthday=n.getBirthday());var a=new PersonalInfoRequestView(i);this.views.add(this.ages[e].toString(),a)}this.personsAdditionalDataRequestView=new PersonsAdditionalDataRequestView},e.prototype.prevButtonClickHandler=function(){this.navigateToPrevPage()},e.prototype.navigateToNextPage=function(){NavigatorUtil.navigateTo(this.nextPage)},e.prototype.navigateToPrevPage=function(){NavigatorUtil.navigateTo(this.prevPage)},e.prototype.nextButtonClickHandler=function(){this.onNextButtonClick()},e.prototype.onNextButtonClick=function(){this.hideError();var t=this.personsAdditionalDataRequestView.validate(),e=t.isValid;if(!e)return this.errorText=t.errorText,void this.onDataInvalid();for(var n=this.views.getIterator();n.hasNext();)if(!(e=n.next().isValid()))return void this.onDataInvalid();this.saveData(),this.navigateToNextPage()},e.prototype.onDataInvalid=function(){this.showError()},e.prototype.personalInfoValueChangedHandler=function(){this.hideError()},e.prototype.hideError=function(){this.$j("#userPersonalDataErrorText").text(""),this.$j("#userPersonalDataErrorText").addClass("hidden");for(var t=this.views.getIterator();t.hasNext();)t.next().dropError()},e.prototype.showError=function(){this.$j("#userPersonalDataErrorText").text(this.errorText),this.$j("#userPersonalDataErrorText").removeClass("hidden")},e.prototype.saveData=function(){for(var t=this.views.getIterator(),e=0;t.hasNext();){var n=t.next().getData(),i=n.age,a=this.persons.getPersonByAge(i);a.setFirstName(n.firstName),a.setLastName(n.lastName),a.setGender(n.gender),a.setBirthday(n.birthday),0==e?a.setRelationship("Primary"):a.setRelationship(n.relationship),e++}Cookie.setPersons(this.persons.getData())},e.prototype.personalInfoFirstNameValidateErrorHandler=function(t){this.errorText="Person with age "+t+" has invalid first name."},e.prototype.personalInfoLastNameValidateErrorHandler=function(t){this.errorText="Person with age "+t+" has invalid last name."},e.prototype.personalInfoBirthdayValidateErrorHandler=function(t){this.errorText="Person with age "+t+" has invalid birthday."},e.prototype.getRateTableGuideData=function(){return this.$j("#companyRateTableGuide").text()},e.prototype.parseRateTableGuide=function(t){return(new RateTableGuideParser).parse(t)},e.prototype.compareFunction=function(t,e){return t>e?-1:1},e.prototype.updatePersonsMedicalDeclarationRequirements=function(){var t=this.getRateTableGuideData(),e=this.parseRateTableGuide(t);new MedicalDeclarationRequirementUpdater(this.persons,e).update()},e}(BasePage),ApplicationFinishPage=function(t){function e(){t.call(this),this.card=this.getCard()}return __extends(e,t),e.prototype.create=function(){this.persons=this.getPersons(),this.companyData=this.getCompany(),this.quoteId=Cookie.getQuoteId(),this.loadQuotePersonsData()},e.prototype.onApplicationSaved=function(){new SendResultEmailPage(this.applicationType).create()},e.prototype.saveApplication=function(){var t=new QuoteSaver,e=Cookie.getPeriod(),n=Cookie.getCompanyPlan(),i=StringUtils.parseURI(n),a=Cookie.getUserInputFormData(),o=StringUtils.parseURI(a),r=o.startDate.date,s=o.finishDate.date;r=r.split("+")[0],s=s.split("+")[0];var c=JSON.stringify({company:this.companyData.companyName,benefit:this.companyData.benefit,period:e,deductible:i.deductible,cost:i.cost,startDate:r,finishDate:s}),u=this.persons.size(),p=Cookie.getCountryOfOrigin(),d=Cookie.getVisitorType(),l=Cookie.getArrivalDate(),h=Cookie.getSponsorFirstName(),f=Cookie.getSponsorLastName(),m=Cookie.getBeneficiaryFirstName(),v=Cookie.getBeneficiaryLastName(),g=Cookie.getAddress(),y=Cookie.getSponsorCity(),C=Cookie.getSponsorProvince(),D=Cookie.getSponsorPostalCode(),N=Cookie.getEmail(),E=Cookie.getPhone();this.applicationType=Cookie.getApplicationType(),this.quoteDataToSave={quoteId:this.quoteId,companyName:this.companyData.companyName,quoteData:c,persons:this.personsData,period:e,numPersons:u,startDate:r,finishDate:s,cardType:this.card.getType(),cardHolderName:this.card.getHolderName(),cardExpDate:this.card.getExpDate(),cardNumber:this.card.getNumber(),countryOfOrigin:p,visitorType:d,arrivalDate:l,sponsorFirstName:h,sponsorLastName:f,beneficiaryFirstName:m,beneficiaryLastName:v,address:g,city:y,province:C,postalCode:D,email:N,phone:E,type:this.applicationType},this.$j("#quoteData").val(JSON.stringify(this.quoteDataToSave)),t.save(this.quoteDataToSave)},e.prototype.getCard=function(){var t=new Card;return t.setExpDate(this.$j("#expirationDate").text()),t.setHolderName(this.$j("#cardholderName").text()),t.setNumber(this.$j("#cardNumber").text()),t.setType(this.$j("#cardType").text()),t},e.prototype.decorateQuoteIdWithCurrentDate=function(){var t=new Date,e=(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()),n=t.getMinutes(),i=t.getSeconds();this.quoteId=DateUtils.getCurrentDate()+"__"+e+"-"+n+"-"+i},e.prototype.onPersonsDataValid=function(){this.decorateQuoteIdWithCurrentDate(),this.saveApplication(),this.$j("#quoteDate").text(this.$j("#quoteData").val()),this.onApplicationSaved(),this.deletePersonsTempData()},e.prototype.deletePersonsTempData=function(){DB.deletePersons(this.quoteId)},e.prototype.getCompany=function(){var t=Cookie.getSelectedCompanyData();return StringUtils.parseURI(t)},e.prototype.loadQuotePersonsData=function(){var t=this;EventBus.addEventListener("personsDataLoadComplete",function(e){return t.personsDataLoadComplete(e)}),DB.loadPersons(this.quoteId)},e.prototype.personsDataLoadComplete=function(t){var e=this;EventBus.removeEventListener("personsDataLoadComplete",function(t){return e.personsDataLoadComplete(t)}),this.onPersonDataLoadComplete(t)},e.prototype.onPersonDataLoadComplete=function(t){this.validatePersonsLoadedData(t)?(this.personsData=t,this.onPersonsDataValid()):console.error("persons loaded data not valid. data: "+t)},e.prototype.validatePersonsLoadedData=function(t){var e=unescape(t);try{JSON.parse(e);return!0}catch(t){return!1}},e}(BasePage),SendResultEmailPage=function(){function t(t){this.receiver="",this.$j=jQuery.noConflict(),this.emailTexts=new Emails,this.applicationType=t,this.emailSender=new EmailSender}return t.prototype.create=function(){var t=this;EventBus.addEventListener("APPLICATION_EMAIL_SENT_RESULT",function(e){return t.onApplicationEmailSentResult(e)}),EventBus.addEventListener("APPLICATION_ADMIN_EMAIL_SENT_RESULT",function(e){return t.onApplicationEmailAdminSentResult(e)}),EventBus.addEventListener("HTML_EXPORT_COMPLETE",function(e){return t.onHTMLExportComplete(e)});var e=this.getQuoteData();this.parseQuoteData(e),this.updateBody(),this.iteratePersons();var n=this.createPersonsShortInfoHTML();this.$j("#personsShortInfoContainer").html(n),this.emailBodyHtml=this.$j("#emailBody").html(),this.emailBodyHtml=this.decorateEmailBody(),this.exportHtml()},t.prototype.exportHtml=function(){(new HTMLExporter).export(this.data.quoteId,this.emailBodyHtml)},t.prototype.onHTMLExportComplete=function(t){var e=JSON.parse(t);this.appId=e.appId,this.applicationHtmlFileUrl=e.url,console.log("applicationHtmlFileUrl="+this.applicationHtmlFileUrl),this.composeEmailBody(),this.sendApplicationAdminEmail()},t.prototype.composeEmailBody=function(){this.applicationType==ApplicationType.HAS_MEDICAL_ISSUES?this.emailBody=this.emailTexts.composeMedicalIssuesEmailText(this.applicationHtmlFileUrl):this.emailBody=this.emailTexts.composeNoMedicalIssuesEmailText(this.applicationHtmlFileUrl)},t.prototype.onApplicationEmailSentResult=function(t){var e=this.$j("<div>"+t+"</div>");e.dialog({modal:!0,buttons:[{text:"Ok",click:function(t){e.dialog("close")}}]})},t.prototype.sendApplicationAdminEmail=function(){console.log("sending application admin email..."),this.emailSender.sendApplicationAdminEmail(this.appId)},t.prototype.sendApplicationResultEmail=function(){this.emailSender.sendApplicationResult(this.receiver,this.emailBody,this.appId)},t.prototype.onApplicationEmailAdminSentResult=function(t){console.log("application admin email send result "+t),this.sendApplicationResultEmail()},t.prototype.decorateEmailBody=function(){return this.emailBodyHtml},t.prototype.getQuoteData=function(){return this.$j("#quoteDate").text()},t.prototype.parseQuoteData=function(t){this.data=JSON.parse(t),this.quoteData=JSON.parse(this.data.quoteData),this.persons=this.getPersons(),this.receiver=unescape(this.data.email)},t.prototype.getPersons=function(){var t=this.data.persons;return new PersonCollectionParser(t).parse()},t.prototype.iteratePersons=function(){for(var t=this.persons.getIterator();t.hasNext();){var e=t.next();new QuotePersonAdminView(e,this.$j("#personsContainer"))}},t.prototype.createPersonsShortInfoHTML=function(){for(var t="<h2><div style='width: 100%; background-color: #d9edf7; text-align: center;'>Insureds</div></h2><table><tbody>",e=this.persons.getIterator();e.hasNext();){var n=e.next(),i="<td style='padding-left: 10px; padding-right: 10px;'>FirstName:</td>";i+="<td style='padding-left: 10px; padding-right: 10px;'><b>"+n.getFirstName()+"</b></td>",i+="<td style='padding-left: 10px; padding-right: 10px;'>Last name:</td>",i+="<td style='padding-left: 10px; padding-right: 10px;'><b>"+n.getLastName()+"</b></td>",i+="<td style='padding-left: 10px; padding-right: 10px;'>Age:</td>",i+="<td style='padding-left: 10px; padding-right: 10px;'><b>"+n.getAge()+"</b></td>",i+="<td style='padding-left: 10px; padding-right: 10px;'>Birthday:</td>",i+="<td style='padding-left: 10px; padding-right: 10px;'><b>"+n.getBirthday()+"</b></td>",i+="<td style='padding-left: 10px; padding-right: 10px;'>Gender:</td>";t+="<tr>"+(i+="<td style='padding-left: 10px; padding-right: 10px;'><b>"+n.getGender()+"</b></td>")+"</tr>"}return t+="</tbody></table>"},t.prototype.updateBody=function(){this.$j("#cardType").text(this.data.address),this.$j("#application").text("Application:   "+this.data.quoteId),this.$j("#company").html("Company: <b>"+unescape(this.data.companyName)+"</b>");var t=StringUtils.formatMoneyInt(this.quoteData.benefit);this.$j("#benefit").html("<b>"+t+"</b>");var e=StringUtils.formatMoneyInt(this.quoteData.deductible);this.$j("#deductible").html("<b>"+e+"</b>");var n=StringUtils.formatDivisionalMoney(this.quoteData.cost);this.$j("#cost").html("<b>"+n+"</b>"),this.$j("#startDate").html("<b>"+this.quoteData.startDate+"</b>"),this.$j("#finishDate").html("<b>"+this.quoteData.finishDate+"</b>"),this.$j("#period").html("<b>"+this.quoteData.period+" day(s)</b>"),this.updateCardInfo(),this.updateVisitorsInfo()},t.prototype.updateCardInfo=function(){var t=unescape(StringUtils.decorateCardNumber(this.data.cardNumber));this.$j("#cardTypeContainer").html("<b>"+unescape(this.data.cardType)+"</b>"),this.$j("#cardHolder").html("<b>"+unescape(this.data.cardHolderName)+"</b>"),this.$j("#cardNumberContainer").html("<b>"+t+"</b>"),this.$j("#cardExpDate").html("<b>***</b>")},t.prototype.updateVisitorsInfo=function(){this.$j("#countryOfOrigin").html("<b>"+unescape(this.data.countryOfOrigin)+"</b>"),this.$j("#visitorType").html("<b>"+unescape(this.data.visitorType)+"</b>"),this.$j("#arrivalDate").html("<b>"+unescape(this.data.arrivalDate)+"</b>"),this.$j("#sponsorFirstName").html("<b>"+unescape(this.data.sponsorFirstName)+"</b>"),this.$j("#sponsorLastName").html("<b>"+unescape(this.data.sponsorLastName)+"</b>"),this.$j("#beneficiaryFirstName").html("<b>"+unescape(this.data.beneficiaryFirstName)+"</b>"),this.$j("#beneficiaryLastName").html("<b>"+unescape(this.data.beneficiaryLastName)+"</b>"),this.$j("#address").html("<b>"+unescape(this.data.address)+"</b>"),this.$j("#city").html("<b>"+unescape(this.data.city)+"</b>"),this.$j("#province").html("<b>"+unescape(this.data.province)+"</b>"),this.$j("#postalCode").html("<b>"+unescape(this.data.postalCode)+"</b>"),this.$j("#email").html("<b>"+unescape(this.data.email)+"</b>"),this.$j("#phone").html("<b>"+unescape(this.data.phone)+"</b>")},t}(),$=jQuery.noConflict(),companyFamilyRateMinNumPersons=3;$(document).ready(function(t){t(window),t(".navbar"),t("body");t.datepicker.setDefaults({dateFormat:"yy-mm-dd"});var e=(new GetCompaniesBenefitsDataJson).execute(),n="simplePage"==t("#pageType").text(),i=t("#pageType").text(),a=PageFactory.create(i);a&&(n?a.create(e):a.create())});