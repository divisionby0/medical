var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},BUY_ONLINE_BUTTON_CLICKED="BUY_ONLINE_BUTTON_CLICKED",EmailSender=function(){function t(){this.$j=jQuery.noConflict()}return t.prototype.sendApplicationResult=function(t,e,n){var i=this,o=this.createApplicationResultData(t,e,n);this.$j.post(ajaxurl,o,function(t){return i.onComplete(t)})},t.prototype.sendApplicationAdminEmail=function(t){var e=this,n={action:"sendApplicationAdminEmail",appId:t};this.$j.post(ajaxurl,n,function(t){return e.onApplicationAdminEmailSent(t)})},t.prototype.createApplicationResultData=function(t,e,n){return{action:"sendApplicationResultEmail",receiver:t,body:e,appId:n}},t.prototype.onComplete=function(t){EventBus.dispatchEvent("APPLICATION_EMAIL_SENT_RESULT",t)},t.prototype.onApplicationAdminEmailSent=function(t){EventBus.dispatchEvent("APPLICATION_ADMIN_EMAIL_SENT_RESULT",t)},t}(),HTMLExporter=function(){function t(){this.$j=jQuery.noConflict()}return t.prototype.export=function(t,e){var n=this,i=this.createApplicationResultData(t,e);this.$j.post(ajaxurl,i,function(t){return n.onComplete(t)})},t.prototype.createApplicationResultData=function(t,e){return{action:"saveApplicationHTML",appId:t,appContent:e}},t.prototype.onComplete=function(t){EventBus.dispatchEvent("HTML_EXPORT_COMPLETE",t)},t}(),PageMarkupResposabilityTS=function(){function t(){this.$j=jQuery.noConflict()}return t.prototype.removeResponsabilityMarkup=function(){this.$j("meta[width='device-width']").remove(),this.$j("meta[initial-scale='1.0']").remove()},t}(),BenefitsJsonDataParser=function(){return{parse:function(t){var e;try{e=JSON.parse(t)}catch(e){return void console.error("Benefits parse error. "+e+". Given string '"+t+"'")}for(var n=new Map("allBenefits"),i=new MapJsonDecoder,o=0;o<e.length;o++)for(var r=e[o],a=(i=new MapJsonDecoder(r)).decode().getIterator();a.hasNext();){var s=a.next();try{n.add(s,s)}catch(t){}}return n}}},GetCompaniesBenefitsDataJson=function(){return{execute:function(){return $("#allBenefits").text()}}},BenefitsKeysSorter=function(){function t(t,e){return t-e}return{sort:function(e){var n,i=new Array;for(n=0;n<e.length;n++)i.push(parseInt(e[n]));return i.sort(t),i}}},Card=function(){function t(t,e,n,i){void 0===t&&(t=""),void 0===e&&(e=""),void 0===n&&(n=""),void 0===i&&(i=""),this.cardNumber=t,this.holderName=e,this.expDate=n,this.type=i}return t.prototype.getNumber=function(){return this.cardNumber},t.prototype.setNumber=function(t){this.cardNumber=t},t.prototype.getHolderName=function(){return this.holderName},t.prototype.setHolderName=function(t){this.holderName=t},t.prototype.getExpDate=function(){return this.expDate},t.prototype.setExpDate=function(t){this.expDate=t},t.prototype.getType=function(){return this.type},t.prototype.setType=function(t){this.type=t},t}(),Persons=function(){function t(t,e){return t-e}var e;return{setCollection:function(t){e=t},findByAge:function(t){for(var n=e.getIterator();n.hasNext();){var i=n.next();if(i.getAge()==t)return i}},getIterator:function(){return e.getIterator()},getAges:function(){for(var n=new Array,i=e.getIterator();i.hasNext();){var o=i.next().getAge();n.push(o)}return n.sort(t),n}}},Person=function(){var t,e,n,i,o;return{create:function(r,a,s,c,u){t=r,e=a,n=s,i=c,o=u},getId:function(){return t},getAge:function(){return e},getBenefit:function(){return n},getUseSCCC:function(){return i},getTotalDays:function(){return o}}},PersonCollectionAgesParser=function(){function t(t,e){return t-e}return{parse:function(e){for(var n=new Array,i=e.getIterator();i.hasNext();){var o=i.next().getAge();n.push(o)}return n.sort(t),n}}}(),FamilyRateDetector=function(){return{detect:function(t,e){var n=e.getAges();return n.sort(),n.length>=companyFamilyRateMinNumPersons&&n[n.length-1]<=t}}}(),GetFormData=function(){var t=jQuery.noConflict();return{init:function(){var e=t("#formData");return JSON.parse(e.text())}}},FormDataParser=function(){function t(t){return"string"==typeof t||t instanceof String?(t=t.replace(/\\"/g,'"'),JSON.parse(t)):t}function e(t){return parseInt(t)}function n(t){return parseInt(t)}function i(t){return"Yes"==t?1:0}return{parse:function(o){var r;try{r=o.startDate.date}catch(t){return}var a=o.finishDate.date,s=(new Date(r),new Date(a),t(o.ages));o.ages=s;var c=i(o.useSccc);o.useSccc=c;var u=e(o.benefit);o.benefit=u;var d=n(o.numPersons);return o.numPersons=d,o}}},CreatePersons=function(){function t(t){var r,a=t.length;for(r=0;r<a;r++){var s=t[r],c=new Person;c.create(r,s,e,i,n),o.add(r,c)}}var e,n,i,o=new Map("persons");return{create:function(r){e=r.benefit,i=r.useSccc,n=r.totalDays,t(r.ages);var a=new Persons;return a.setCollection(o),a}}},CountriesSelect=function(){function t(){n=i("#countriesSelect")}function e(){var t=i("<option value='null' selected='selected'>Select country</option>");n.prepend(t),t.prop("disabled",!0)}var n,i=jQuery.noConflict();return{init:function(){t(),e()}}},SelectionForm=function(){function t(t,e,n,i){this.selectedItem=1,this.$j=jQuery.noConflict(),this.inputElementId=e,this.inputElement=this.getInputElement(),this.formId=n,this.form=this.getFormElement(),this.tableId=i,this.table=this.getTableElement(),this.addListener(),console.log("selectedItem=",t),t&&(this.selectedItem=t,this.updateSelectedIndexByValue(this.selectedItem),this.selectedIndex+=1),this.selectItem(this.selectedIndex),this.updateInput()}return t.prototype.submit=function(){this.$j("#"+this.formId).submit()},t.prototype.getSelection=function(){return this.selectedItem},t.prototype.getInputElement=function(){return this.$j("#"+this.inputElementId)},t.prototype.getFormElement=function(){return this.$j("#"+this.formId)},t.prototype.getTableElement=function(){return this.$j("#"+this.tableId)},t.prototype.updateInput=function(){this.inputElement.val(this.selectedItem)},t.prototype.selectItem=function(t){var e=this.$j("#"+this.tableId+" > tbody  > tr").eq(t);this.selectedItem=e.attr("id"),e.addClass("itemSelected"),this.selectedRow=e},t.prototype.updateSelectedIndexByValue=function(t){var e=this;this.selectedIndex=-1,this.$j("#"+this.tableId+" > tbody  > tr").not(":first").each(function(n,i){return e.findIndex(n,i,t)})},t.prototype.findIndex=function(t,e,n){var i=this.$j(e).attr("id");parseInt(i)==parseInt(n)&&(this.selectedIndex=t)},t.prototype.tableRowIterator=function(t,e){this.addListeners(e)},t.prototype.addListeners=function(t){var e=this;this.$j(t).hover(function(t){return e.onRowHoverIn(t)},function(t){return e.onRowHoverOut(t)}),this.$j(t).click(function(t){return e.onClick(t)})},t.prototype.onClick=function(t){var e=this.$j(t.target).parent(),n=e.attr("id");this.selectedItem=n,this.updateInput();try{this.selectedRow.removeClass("itemSelected")}catch(t){}this.selectedRow=e,this.submitForm(),e.addClass("itemSelected")},t.prototype.onRowHoverIn=function(t){this.$j(t.target).parent().addClass("itemHovered")},t.prototype.onRowHoverOut=function(t){this.$j(t.target).parent().removeClass("itemHovered")},t.prototype.addListener=function(){var t=this;this.$j("#"+this.tableId+" > tbody  > tr").not(":first").each(function(e,n){return t.tableRowIterator(e,n)})},t.prototype.submitForm=function(){},t}(),BenefitSelectionFormTS=function(t){function e(e,n,i,o){t.call(this,e,n,i,o)}return __extends(e,t),e.prototype.submitForm=function(){EventBus.dispatchEvent("BENEFIT_SELECTED",this.selectedItem)},e}(SelectionForm),SCCCParser=function(){return{parse:function(t){var e=new MapJsonDecoder(t).decode(),n=new SCCC;return n.create(e),n}}},DeductibleAmountOptionsParser=function(){return{parse:function(t){var e=new MapJsonDecoder(t).decode(),n=new DeductibleAmountOptions;return n.create(e),n}}},StandardRatesParser=function(){return{parse:function(t){var e=new MapJsonDecoder(t).decode(),n=new StandardRates;return n.create(e),n}}},RateTableGuideParser=function(){return{parse:function(t){for(var e=new MapJsonDecoder(t),n=e.decode(),i=n.getKeys(),o=0;o<i.length;o++){var r=i[o],a=n.get(r);if("string"==typeof a||a instanceof String){var s=(e=new MapJsonDecoder(a)).decode();n.update(r,s)}}var c=new RateTableGuide;return c.create(n),c}}},SCCC=function(){var t;return{create:function(e){t=e},getCost:function(e,n){var i=t.get(e.toString());return i?i.get(n.toString())/1e3:-1}}},StandardRates=function(){var t;return{create:function(e){t=e},getCost:function(e,n){var i=t.get(e.toString());return i?i.get(n.toString())/1e3:null}}},GetDefaultRateTableGuideDataOperation=function(){var t;return{setStrategy:function(e){t=e},execute:function(e,n,i){return t.getDeductibleAndTable(e,n,i)}}},GetMedicalDeclarationRequiredOperation=function(){var t;return{setStrategy:function(e){t=e},execute:function(e,n,i){return t.getMedicalDeclarationRequired(e,n,i)}}},MedicalDeclarationRequirementUpdater=function(){function t(t,e){this.persons=t,this.rateTableGuide=e}return t.prototype.update=function(){for(var t=this.persons.getIterator();t.hasNext();){var e=t.next(),n=e.getAge(),i=e.getIsUseSCCC(),o=this.rateTableGuide.isMedicalDeclarationRequired(n,i);e.setMedicalDeclarationRequired(o),console.log("Person "+n+"  medicalDeclarationRequired="+o)}},t}(),AgeUnderDefaultStrategy=function(){this.getDeductibleAndTable=function(t){var e=t.getKeys()[0],n=t.get(e);return console.log("AgeUnderDefaultStrategy rateTableGuideItem:"),console.log(n),{deductible:n.get("deductible"),table:n.get("premiumTable")}}},AgeOverDefaultStrategy=function(){function t(t,e){var n=parseInt(t.get("ageFrom")),i=parseInt(t.get("ageTill")),o=!1;return e>=n&&e<=i&&(o=!0),!!o}return{getDeductibleAndTable:function(e,n,i){for(var o=-1,r="notAvailble",a=e.getIterator();a.hasNext();){var s=a.next();if(t(s,n)){o=s.get("deductible"),r=s.get("premiumTable");var c=s.get("scco");if(c==i||-1==c)return{deductible:o,table:r}}}},getMedicalDeclarationRequired:function(e,n,i){for(var o=e.getIterator();o.hasNext();){var r=o.next();if(t(r,n)){var a=r.get("scco");if(a==i||-1==a)return 1==r.get("mdr")}}}}},RateTableGuide=function(){function t(t,n){var i,o=new GetDefaultRateTableGuideDataOperation;return i=new AgeOverDefaultStrategy,o.setStrategy(i),o.execute(e,t,n)}var e;return{create:function(t){e=t},getDefaultData:function(e,n){return t(e,n)},isMedicalDeclarationRequired:function(t,n){console.log("isMedicalDeclarationRequired   age="+t+"  useSccc="+n);var i=new GetMedicalDeclarationRequiredOperation,o=new AgeOverDefaultStrategy;return i.setStrategy(o),i.execute(e,t,n)}}},DeductibleAmountOptions=function(){function t(t,e,n){return parseInt(t)>=parseInt(e)&&parseInt(t)<=parseInt(n)}var e;return{create:function(t){e=t},getDeductibles:function(){for(var t=new Array,n=e.getIterator();n.hasNext();){var i=n.next();t.push(i.get("deductible"))}return t},getSurchargeOrDiscountProcent:function(n,i,o){for(var r=e.getIterator(),a=new List("procentsByDeductible");r.hasNext();){var s=r.next(),c=s.get("deductible"),u=s.get("aggregatePolicyLimit");if(t(o,s.get("ageFrom"),s.get("ageTill"))&&c==n&&(i==u||"any"==u)){var d=s.get("surchargeOrDiscount");a.add({deductible:c,procent:d,benefit:u})}}return a}}},UpdateCostByDeductibleAmountOption=function(){function t(t,e){for(var n=t.getKeys(),i=0;i<n.length;i++){var o=n[i],r=e+e/100*t.get(o);t.update(o,r)}return t}var e;return{setTable:function(t){e=t},update:function(n,i,o){new Map("costs");for(var r=e.getDeductibles(),a=new Map("companyCostsByBenefitAndAge"),s=0;s<r.length;s++)for(var c=r[s],u=e.getSurchargeOrDiscountProcent(c,n,i).getIterator();u.hasNext();){var d=u.next(),l=d.deductible,p=d.procent,h=d.benefit;if(h==n||"any"==h)try{a.add(l,p)}catch(t){}}return a=t(a,o)}}},CompaniesCostsCalculator=function(){return{execute:function(t,e,n,i){for(var o=e.getIterator();o.hasNext();){var r=o.next();r.setSelectedBenefit(n),r.setPeriod(i),r.calculateCosts(t)}}}},RemoveEmptyCosts=function(){return{execute:function(t){for(var e=t.getIterator();e.hasNext();){var n=e.next(),i=(n.getId(),n.getDeductiblesCosts());i&&0==i.size()&&(i=null)}}}},CreateTableDataProvider=function(){return{execute:function(t){for(var e=new List("tableDataProvider"),n=t.getIterator();n.hasNext();){var i=n.next(),o=i.getDeductiblesCosts();null!=o&&0!=o.size()&&e.add(i)}return e}}},SortCompaniesByZeroDeductibleCost=function(){function t(t,e){return t.zeroDeductible-e.zeroDeductible}function e(e){e.sort(t)}return{sort:function(t){for(var n=new Array,i=new List("companies"),o=t.getIterator();o.hasNext();){var r=(u=o.next()).getDeductiblesCosts();if(r&&0!=r.size()){var a=r.get("0");n.push({zeroDeductible:parseFloat(a).toFixed(2),companyId:u.getId()})}}e(n);for(var s=0;s<n.length;s++){var c=n[s].companyId,u=t.get(c);i.add(u)}return i}}},CompanyDeductibles=function(){function t(){for(var t=n.getKeys(),e=0;e<t.length;e++){var o=t[e];i.add(o,NaN)}}function e(t,e){if(i.has(t)){var n=i.get(t);isNaN(n)&&(n=0);var o=n+e;i.update(t,o)}}var n,i=new Map("deductiblesCosts");return{setCollection:function(e){n=e,t(),console.log("")},getCollection:function(){return n},getCosts:function(){return i},excludeUnavailableCosts:function(){for(var t=new Map("deductiblesCosts"),e=i.getKeys(),n=0;n<e.length;n++){var o=e[n],r=i.get(o);!isNaN(r)&&r>0&&t.add(o,r)}i=t},updateCosts:function(t){if(t)for(var n=t.getKeys(),i=0;i<n.length;i++){var o=n[i];e(o,t.get(o))}}}},CompanyDeductiblesParser=function(){return{parse:function(t){return new MapJsonDecoder(t).decode()}}},CompanyModel=function(){function t(t){var e=new RateTableGuideParser;D=e.parse(t)}function e(t){var e=new DeductibleAmountOptionsParser;E=e.parse(t)}function n(t){var e=new SCCCParser;N=e.parse(t)}function i(t){var e=new StandardRatesParser;I=e.parse(t)}function o(t){var e=new MapJsonDecoder(t);T=e.decode()}function r(t,e){return D.getDefaultData(t,e)}function a(t,e){(w=r(t,e))?(B=w.deductible,A=w.table):(console.error("Company "+y+" has no data for age "+t+"  and selected sccc "+e+"! Excluding."),h())}function s(t,e){H&&(k=R.getCost(t,e))}function c(t){"standardRatesMap"==t?R=I:"scccMap"==t?R=N:(console.error("Company "+y+" no default table selected! tableName="+t+" Excluding."),h())}function u(){c(L?S:A)}function d(){O=$.update(V,j,k)}function l(t){for(var e=O.getKeys(),n=0;n<e.length;n++){var i=e[n],o=O.get(i);o*=t,O.update(i,o)}}function p(t){console.log("Company",y,"getCostsForPerson ",t.getAge()),j=t.getAge();var e=t.getIsUseSCCC();return a(j,e),u(),s(V,j),-1==k?(h(),null):(d(),l(U),O)}function h(){H=!1}function f(t){return v(t)}function v(t){for(var e=t.getAges(),n=[],i=0;i<e.length;i++)n.push(parseInt(e[i]));return n.sort(function(t,e){return e-t}),[n[0]]}function g(t){for(var e=(_=f(t))[0],n=p(t.getPersonByAge(e.toString())),i=new Map("costs"),o=n.getKeys(),r=0;r<o.length;r++){var a=o[r],s=2*n.get(a);i.add(a,s)}Q.updateCosts(i)}function m(t){for(var e=t.getIterator();e.hasNext();){var n=p(e.next());Q.updateCosts(n)}}var C,y,D,b,E,N,I,x,S,T,P,w,A,R,B,j,k,O,$,L,F,M,_,V,U,Q=new CompanyDeductibles,H=!0;return{init:function(t,e){C=t,y=e,$=new UpdateCostByDeductibleAmountOption},setUrl:function(t){P=t},getUrl:function(){return P},setBenefitsText:function(t){F=t},setLimitationsText:function(t){M=t},getBenefitsText:function(){return F},getLimitationsText:function(){return M},setRateTableGuide:function(e){b=e,t(e)},getRateTableGuide:function(){return b},isMedicalDeclarationRequired:function(t,e){return console.log("Company "+y+"  isMedicalDeclarationRequired age="+t+"  useSCCC="+e),D.isMedicalDeclarationRequired(t,e)},setDeductibleAmountOptions:function(t){e(t),$.setTable(E)},setSCCC:function(t){n(t)},setStandardRates:function(t){i(t)},setFamilyRateMaxAge:function(t){x=t},setFamilyRatePremiumTable:function(t){S=t},setBenefits:function(t){o(t)},setSelectedBenefit:function(t){V=t},setPeriod:function(t){U=t},setDeductibles:function(t){var e=new CompanyDeductiblesParser;Q.setCollection(e.parse(t))},getDeductibles:function(){return Q.getCollection()},getId:function(){return C},getName:function(){return y},calculateCosts:function(t){(L=FamilyRateDetector.detect(x,t))?g(t):m(t),Q.excludeUnavailableCosts()},getDeductiblesCosts:function(){return H?Q.getCosts():null},getIsFamilyRate:function(){return L},getIsFamilyRateAges:function(){return _}}},CompanyTableRowView=function(){function t(t){return a('<div class="fullwidth centered resultTableTextDataReadMore"><a id="readMoreLink" href="'+t+'">read more</a></div>')}function e(t,e){var i=a('<div class="buyButton centered" id="buyButton" data-companyId="'+t+'" data-companyName="'+e+'"><button type="button" class="btn btn-success">Order online</button></div>');return n(i),i}function n(t){t.on("click",i)}function i(){var t=a(this),e=t.attr("data-companyName"),n=t.attr("data-companyid"),i=t.attr("data-medicalDeclarationRequired");console.log("clicked element = "+t.attr("id")+"  companyId="+t.attr("data-companyId")+"name:"+e+"  medicalDeclarationRequired="+i),o(e,n,i)}function o(t,e,n){EventBus.dispatchEvent(BUY_ONLINE_BUTTON_CLICKED,{name:t,id:e,medicalDeclarationRequired:n})}var r,a=jQuery.noConflict();return{create:function(n){r=n,console.log("company: ",r);var i,o=r.getName(),s=r.getId(),c=r.getDeductiblesCosts(),u=r.getUrl(),d=r.getBenefitsText(),l=r.getLimitationsText(),p=r.getIsFamilyRate(),h=a('<tr class="resultTableRow companyTableRow" id="company_126" data-companyid="'+s+'" data-companyname="'+o+'">'),f=a('<td class="planTableColumn">');f.appendTo(h);var v=a('<div class="fullwidth centered colorRed companyName">');a('<a href="'+u+'" class="colorRed"><b>'+o+"</b></a>").appendTo(v),v.appendTo(f);var g=a('<table class="fullwidth planTable" id="planTable">');g.appendTo(f),a('<tr class="resultTableRow"><th class="fullwidth centered">Deductible</th><th class="fullwidth centered">Premium</th></tr>').appendTo(g);for(var m=c.getKeys(),C=0;C<m.length;C++){var y=m[C],D=c.get(y).toFixed(2);a('<tr class="resultTableRow companyBenefitAndCost"><td class="planTableItemRenderer benefit">$ '+y+'</td><td class="planTableItemRenderer benefitCost">$ '+D+"</td></tr>").appendTo(g)}p&&a('<div class="centered familyRateInfo">Family Rate</div>').appendTo(f),e(s,o).appendTo(f);var b=a('<td class="companyTableItemRenderer resultTableTextDataPositionRelative">'),E=a('<div class="companyTextData" id="limitationsText"><p>'+l+"</p></div>");i=t(u),E.appendTo(b),i.appendTo(b),b.appendTo(h);var N=a('<td class="companyTableItemRenderer resultTableTextDataPositionRelative">'),I=a('<div class="companyTextData" id="benefitsText"><p>'+d+"</p></div>");return i=t(u),I.appendTo(N),i.appendTo(N),N.appendTo(h),h}}},CompaniesTable=function(){function t(){c=new Map("companiesRowsElements"),d(".companyTableRow").each(function(){var t=d(this),e=t.data("companyid");c.add(e,t)})}function e(){d(".companyTableRow").each(function(){d(this).remove()})}function n(){for(var t=c.getIterator();t.hasNext();){var e=t.next(),n=(e.attr("id"),e.data("companyid")),i=e.data("companyname"),o=new CompanyModel;o.init(n,i),l.add(n,o),e.find(".companyTextData").each(function(){switch(d(this).attr("id")){case"benefitsText":o.setBenefitsText(d(this).html());break;case"limitationsText":o.setLimitationsText(d(this).html());break;case"rateTableGuideText":o.setRateTableGuide(d(this).text());break;case"scccText":o.setSCCC(d(this).text());break;case"standartRatesText":o.setStandardRates(d(this).text());break;case"deductibleAmountOptionsText":o.setDeductibleAmountOptions(d(this).text());break;case"benefitsCollection":o.setBenefits(d(this).text());break;case"deductiblesCollection":o.setDeductibles(d(this).text());break;case"familyRateMaxAgeText":o.setFamilyRateMaxAge(parseInt(d(this).text()));break;case"familyRatePremiumTable":o.setFamilyRatePremiumTable(d(this).text())}})}}function i(t){var e=u.get(t.getName());t.setUrl(e),(new CompanyTableRowView).create(t).appendTo(d("#companiesTable"))}function o(){EventBus.addEventListener("FAMILY_RATE_DETECTED",r)}function r(t){var e=t.ages;d("#familyRateInfo").show(),d("#familyRateInfo").text("Family rate. Ages: "+e)}function a(){var t=d("#urls").text(),e=JSON.parse(t);u=s(e)}function s(t){var e=new Map("urls");for(var n in t)e.add(n,t[n]);return e}var c,u,d=jQuery.noConflict(),l=new Map("companies");return{getData:function(){return o(),t(),n(),l},setData:function(t){u=new Map("urls"),a(),e();for(var n=t.getIterator();n.hasNext();)i(n.next())}}},AgeInputRow=function(){function t(){a('[id*="ageRow_"]').click(function(){n(a(this).attr("id")),a(this).data("rowstate")}),EventBus.addEventListener("SAVED_AGES_CHANGED",e)}function e(t){r=i(t.data),o()}function n(t){return t.substring(7,t.length)}function i(t){return"string"==typeof t||t instanceof String?(t=t.replace(/\\/g,""),JSON.parse(t)):t}function o(){for(var t=0;t<r.length;t++)a("#agesSelect_"+t).val(r[t])}var r,a=jQuery.noConflict();return{init:function(){t()}}},AgesSelection=function(){function t(t){e(t.data)}function e(t){n(t)}function n(t){for(var e=m.length-1;e>-1;e--){var n=D.get(m[e]);e<t?(n.removeClass("invisible"),d(e,y("#agesSelect_"+e).val())):(i(e),o(e),u(e),n.addClass("invisible"))}}function i(t){y("#agesSelect_"+t).val(0)}function o(t){y("#ageCalendarInput_"+t).val("")}function r(){y(".ageRow").each(function(t){var e=y(this).attr("id");s(e=e.replace("ageRow_",""),y(this))}),a()}function a(){m=D.getKeys()}function s(t,e){D.add(t,e)}function c(t){d(t.id,t.value)}function u(t){b.splice(t,1),h()}function d(t,e){b[t]=e,h()}function l(t){for(var e=p(t.data),n=0;n<e.length;n++)d(n,e[n])}function p(t){return"string"==typeof t||t instanceof String?(t=t.replace(/\\/g,""),JSON.parse(t)):t}function h(){C.val(JSON.stringify(b))}function f(){C=y("#ages")}function v(){y('select[id^="agesSelect_"]').each(function(t){y(this).on("change",function(){var e=t;d(e,y(this).val()),g(e)})})}function g(t){y("#ageCalendarInput_"+t).val("")}var m,C,y=jQuery.noConflict(),D=new Map("agesElements"),b=new Array;return{init:function(){f(),r(),n(1),h(),v(),EventBus.addEventListener("NUM_PERSONS_CHANGED",t),EventBus.addEventListener("ON_AGE_CHANGED",c),EventBus.addEventListener("SAVED_AGES_CHANGED",l)}}},UseSccc=function(){function t(){EventBus.addEventListener("SAVED_USE_SCCC_CHANGED",e)}function e(t){n(t.data)}function n(t){i("input[name=scccCovering][value="+t+"]").attr("checked","checked")}var i=jQuery.noConflict();return{init:function(){t()}}},NumPersons=function(){function t(t){e("#numPersonsSelect").val(t.data),EventBus.dispatchEvent("NUM_PERSONS_CHANGED",{data:t.data})}var e=jQuery.noConflict();return{init:function(){EventBus.addEventListener("SAVED_NUM_PERSONS_CHANGED",t),e("#numPersonsSelect").change(function(){EventBus.dispatchEvent("NUM_PERSONS_CHANGED",{data:e(this).val()})})}}},StartDateCalendar=function(){function t(t,e,n){o("#startDateMonth").val(e),o("#startDateYear").val(t),o("#startDateDay").val(n)}function e(e){var n=DateUtils.parseToArray(e);t(n[0],n[1],n[2])}function n(){EventBus.addEventListener("SAVED_START_DATE_CHANGED",i)}function i(t){var n=DateUtils.parseDate(t.data.date);o("#startDateCalendarContainer").val(n),e(n)}var o=jQuery.noConflict();return{init:function(){try{var t=DateUtils.getCurrentDate();o("#startDateCalendarContainer").val(t),o("#startDateCalendarContainer").datepicker({onSelect:function(t){e(t)},minDate:0,defaultDate:new Date}),e(DateUtils.getCurrentDate()),n()}catch(t){}}}},FinishDateCalendar=function(){function t(t,e,n){o("#finishDateMonth").val(e),o("#finishDateYear").val(t),o("#finishDateDay").val(n)}function e(e){var n=DateUtils.parseToArray(e);t(n[0],n[1],n[2])}function n(){EventBus.addEventListener("SAVED_FINISH_DATE_CHANGED",i)}function i(t){var n=DateUtils.parseDate(t.data.date);o("#finishDateCalendarContainer").val(n),e(n)}var o=jQuery.noConflict();return{init:function(){try{var t=DateUtils.getTomorrowDate(),i=new Date;i.setDate(i.getDate()+1),o("#finishDateCalendarContainer").val(t),o("#finishDateCalendarContainer").datepicker({onSelect:function(t){e(t)},minDate:1,defaultDate:i}),e(t),n()}catch(t){}}}},BenefitsSelectionForm=function(){function t(){a("#selectedBenefitInput").val(s)}function e(){Cookie.setBenefit(s),a("#benefitSelectionForm").submit()}function n(){a("#benefitsSelectionForm > tbody  > tr").not(":first").each(function(){a(this).hover(function(){a(this).addClass("itemHovered")},function(){a(this).removeClass("itemHovered")}),a(this).click(function(){var n=a(this).attr("id");if(n!=s){s=n,t();try{r.removeClass("itemSelected")}catch(t){}r=a(this)}a(this).addClass("itemSelected"),e()})})}function i(t){var e=a("#benefitsSelectionForm > tbody  > tr").eq(t);s=e.attr("id"),e.addClass("itemSelected"),r=e}function o(t){var e=-1;return a("#benefitsSelectionForm > tbody  > tr").not(":first").each(function(n){var i=a(this).attr("id");parseInt(i)==parseInt(t)&&(e=n)}),e}var r,a=jQuery.noConflict(),s=1;return{init:function(e){n();var r=1;e&&(r=o(s=e),r+=1),i(r),t()}}},CompanyPlanSelectionForm=function(t){function e(e,n,i,o){t.call(this,e,n,i,o)}return __extends(e,t),e.prototype.submitForm=function(){EventBus.dispatchEvent("COMPANY_PLAN_SELECTED",{deductible:this.selectedItem})},e}(SelectionForm),UserDataInputForm=function(){function t(){s=u("#benefitsSelect")}function e(){var t,e=new BenefitsKeysSorter;try{t=e.sort(a.getKeys())}catch(t){return}for(i=0;i<t.length;i++){var n=t[i],o=parseInt(a.get(n)),r=MoneyFormatter.format(o,2,":"," ");u('<option value="'+o+'">$'+r+"</option>").appendTo(s)}}function n(){if(Cookie.isEnabled()){var t=Cookie.getUserInputFormData();return t?(c=o(t),!0):(console.error("Error parsing cookie. "),!1)}return alert("Cookie disabled. This site need cookie to be enabled."),!1}function o(t){return StringUtils.parseURI(t)}function r(){if(c){var t=c.numPersons,e=c.ages,n=(c.benefit,c.startDate),i=c.finishDate,o=c.useSccc;EventBus.dispatchEvent("SAVED_NUM_PERSONS_CHANGED",{data:t}),EventBus.dispatchEvent("SAVED_AGES_CHANGED",{data:e}),EventBus.dispatchEvent("SAVED_START_DATE_CHANGED",{data:n}),EventBus.dispatchEvent("SAVED_FINISH_DATE_CHANGED",{data:i}),EventBus.dispatchEvent("SAVED_USE_SCCC_CHANGED",{data:o})}}var a,s,c,u=jQuery.noConflict();return{init:function(i){a=i,n();var o=null!=c||void 0!=c;t(),e(),o&&r()}}},ResultTableEmail=function(){function t(){return d("#emailInput").val()}function e(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}function n(){a.click(function(){if(e(u=t())){var n={action:"sendResultFormEmail",data:c,receiver:u};d.post(ajaxurl,n,function(t){console.log("email sending response: "+t),i("complete"==JSON.parse(t).result?"Email sent":"Error sending email")})}else alert("Email address not valid.")})}function i(t){var e=d("<div>"+t+"</div>");e.dialog({modal:!0,buttons:[{text:"Ok",click:function(t){e.dialog("close")}}]})}function o(t,e){var n=new Array;return d("<table><tbody><tr><td>Deductible</td><td>Premium</td></tr></tbody>").appendTo(e),t.find(".companyBenefitAndCost").each(function(){var t=d(this),e=t.find(".benefit").text(),i=t.find(".benefitCost").text();n.push({benefit:e,cost:i})}),n}function r(){var t=d("#testTableContainer"),e=d("<div>");e.appendTo(t);var n=d('<table style="border-bottom: 1px solid #ddd;"><tbody><tr><td style="width: 200px; text-align: center;"><b>Plan</b></td><td style="width: 300px; text-align: center;"><b>Exclusions and Limitations</b></td><td style="width: 300px; text-align: center;"><b>Benefits</b></td></tr></tbody>');n.appendTo(e);var i=d(".userDataSelectionInfoContainer").text(),r=new Array;d(".companyTableRow").each(function(){var t=d(this),e=t.data("companyname"),i=t.find("#readMoreLink").attr("href"),a=d("<tr>"),s=d('<td style="width: 200px; text-align: center;"><b style="color: #bd070f">'+e+"</b></td>");s.appendTo(a),a.appendTo(n);var c=o(t,s),u=t.find("#benefitsText").html(),l=t.find("#limitationsText").html();r.push({name:e,url:i,plan:c,benefits:u,limitations:l})});var a={userDataInfo:i,companies:r};return a=JSON.stringify(a)}var a,s,c,u,d=jQuery.noConflict();return{init:function(){a=d("#sendEmailButton"),n(),c=r(),s=d("#resultPageContent").html()}}},BasePage=function(){function t(){this.$j=jQuery.noConflict()}return t.prototype.getPersons=function(){var t=Cookie.getPersons(),e=StringUtils.parseURI(t),n=new MapJsonDecoder(JSON.stringify(e)).decode();return this.parsePersons(n)},t.prototype.parsePersons=function(t){for(var e=new QuotePersonCollection,n=t.getIterator();n.hasNext();){var i=n.next(),o=i._age,r=i._firstName,a=i._lastName,s=i._gender,c=i._relationship,u=i._questions,d=i._birthday,l=i._complete,p=i._useSCCC,h=i._period,f=i._medicalDeclarationRequired,v=new QuotePerson(o,r,a,s,c,d,u);v.setIsComplete(l),v.setIsUseSCCC(p),v.setPeriod(h),v.setMedicalDeclarationRequired(f),e.add(v)}return e},t}(),PersonDetailsErrorView=function(){function t(t){this.container=t}return t.prototype.showAnswerError=function(){this.container.text("Error. You must answer YES at least the first question !"),this.container.removeClass("hidden")},t.prototype.showConfirmationError=function(){this.container.text("Error. You must confirm all data !"),this.container.removeClass("hidden")},t.prototype.destroy=function(){this.container.addClass("hidden"),this.container.text("")},t}(),PersonQuestionsView=function(){function t(t,e){this.hasAnsweredSavedQuestions=!1,this.$j=jQuery.noConflict(),this.person=t,this.companyId=e,this.createChildren()}return t.prototype.destroy=function(){this.$j("#questionsRootContainer").empty()},t.prototype.isValid=function(){return new PersonMedicalDeclarationAnswerValidator(this.userQuestionsView.getData()).validate()},t.prototype.getAnswers=function(){return this.person.getQuestions().getEncoder().encode()},t.prototype.createChildren=function(){this.$j("#personHeaderContainer").show(),this.$j("#confirmationHeaderContainer").hide(),this.$j("#personHeaderContainer").text(this.person.getFirstName()+"   "+this.person.getLastName()),this.$j("#firstNameContainer").text(this.person.getFirstName()),this.$j("#lastNameContainer").text(this.person.getLastName()),this.$j("#genderContainer").text(this.person.getGender()),this.$j("#dateOfBirthContainer").text(this.person.getBirthday()),this.$j("#ageContainer").text(this.person.getAge()),this.getQuestions()},t.prototype.getQuestions=function(){this.questionsIsLoaded()?this.createSavedQuestionsFrontend():this.loadQuestions()},t.prototype.onQuestionsLoadComplete=function(t){this.$j("#questionsPreloaderTextContainer").addClass("hidden");var e,n=new MapJsonDecoder(t).decode(),i=QuestionCollectionParser.parse(n,"");console.log("this.person.getMedicalDeclarationRequired()="+this.person.getMedicalDeclarationRequired());var o=(e=this.person.getMedicalDeclarationRequired()?i:new QuestionCollectionCutter(i).getQuestionsBeforeFirstBoolean()).getEncoder().encode();this.userQuestionsView=new FrontendUserQuestions(o,"questionsRootContainer"),this.person.setQuestions(this.userQuestionsView.getData())},t.prototype.questionsIsLoaded=function(){return!this.$j.isEmptyObject(this.person.getQuestions())},t.prototype.loadQuestions=function(){var t=this;this.$j("#questionsPreloaderTextContainer").removeClass("hidden");var e={action:"loadQuestions",companyId:this.companyId};this.$j.post(ajaxurl,e,function(e){return t.onQuestionsLoadComplete(e)})},t.prototype.createSavedQuestionsFrontend=function(){var t=this.person.getQuestions().getEncoder().encode();this.userQuestionsView=new FrontendUserQuestions(t,"questionsRootContainer"),this.person.setQuestions(this.userQuestionsView.getData())},t}(),PersonConfirmationView=function(){function t(t){this.$j=jQuery.noConflict(),this.person=t,this.containerId="questionsRootContainer",this.createChildren()}return t.prototype.destroy=function(){this.$j("#"+this.containerId).empty()},t.prototype.isValid=function(){return this.confirmCheckBox.is(":checked")},t.prototype.createChildren=function(){this.$j("#personHeaderContainer").hide(),this.$j("#confirmationHeaderContainer").show(),this.createConfirmCheckBox(),this.updatePersonPrivateDetails(),this.$j("#"+this.containerId).append(this.checkBoxContainer)},t.prototype.createConfirmCheckBox=function(){this.confirmCheckBox=this.$j('<input type="checkbox" id="confirmCheckBox">  <label for="confirmCheckBox" class="text-success"> I confirm all this data !</label><br/>'),this.checkBoxContainer=this.$j("<div style='width:100%; text-align: center; display:inline-block; text-align: center;' id='cont'>").append(this.confirmCheckBox)},t.prototype.updatePersonPrivateDetails=function(){this.$j("#personHeaderContainer").text(this.person.getFirstName()+"   "+this.person.getLastName()),this.$j("#firstNameContainer").text(this.person.getFirstName()),this.$j("#lastNameContainer").text(this.person.getLastName()),this.$j("#genderContainer").text(this.person.getGender()),this.$j("#dateOfBirthContainer").text(this.person.getBirthday()),this.$j("#ageContainer").text(this.person.getAge())},t}(),PersonConfirmationAnswersView=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.prototype.createChildren=function(){var e=this.person.getQuestions();this.answers=e.getEncoder().encode(),this.loadAnswers(),t.prototype.createChildren.call(this)},e.prototype.loadAnswers=function(){this.answersView=new FrontendUserAnswers(this.answers,this.containerId)},e}(PersonConfirmationView),PersonMedicalDeclarationAnswerValidator=function(){function t(t){this.questions=t}return t.prototype.validate=function(){var t=new FirstRootQuestion(this.questions).getAnswer();return t&&t.getType()==ObjectType.BOOLEAN_ANSWER?"Yes"==t.getValue():(console.error("First sub question is not boolean."),!1)},t}(),QuizTestingPage=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.create=function(){console.log("Quiz testing page create...");var t=this.$j("#sampleQuestions").text();console.log("questions: "+t),new FrontendUserQuestions(t,"questionsRootContainer")},QuizT}(BasePage),PersonDetailsPage=function(t){function e(){t.call(this),this.prevPage="application-creation",this.nextPage="/medicalissusselectionpage",this.QUESTIONS="QUESTIONS",this.CONFIRMATION="CONFIRMATION",this.COMPLETE="COMPLETE",this.PREV_PAGE_REQUESTED="PREV_PAGE_REQUESTED",this.answerInvalidErrorType="answerInvalid",this.confirmationInvalidErrorType="confirmationInvalid"}return __extends(e,t),e.prototype.create=function(){this.companyData=this.getCompany(),this.parseCompany(this.companyData),this.persons=this.getPersons(),this.currentPerson=this.getUncompletePerson(),this.onCurrentPersonChanged(),this.createNavigationListeners()},e.prototype.onCurrentPersonChanged=function(){void 0===this.currentPerson?(this.savePersonsData(),this.navigateTo(this.nextPage)):(this.currentState=this.QUESTIONS,this.onStateChanged())},e.prototype.savePersonsData=function(){var t=Cookie.getQuoteId(),e=this.persons.getData(),n=escape(e);DB.savePersons(n,t)},e.prototype.getUncompletePerson=function(){for(var t=this.persons.getIterator();t.hasNext();){var e=t.next();if(!e.getIsComplete())return e}},e.prototype.onStateChanged=function(){this.currentState==this.QUESTIONS?this.showQuestions():this.currentState==this.CONFIRMATION&&this.showConfirmation()},e.prototype.showQuestions=function(){this.questionsView=new PersonQuestionsView(this.currentPerson,this.companyId)},e.prototype.hideQuestions=function(){this.questionsView&&this.questionsView.destroy()},e.prototype.showConfirmation=function(){this.confirmationView=new PersonConfirmationAnswersView(this.currentPerson)},e.prototype.hideConfirmation=function(){this.confirmationView&&this.confirmationView.destroy()},e.prototype.createNavigationListeners=function(){var t=this;this.$j("#nextButton").click(function(){return t.onNextButtonClick()}),this.$j("#prevButton").click(function(){return t.onPrevButtonClick()})},e.prototype.onNextButtonClick=function(){this.hideError(),this.currentState==this.QUESTIONS?this.questionsView.isValid()?this.onQuestionsAnswerValid():this.showError(this.answerInvalidErrorType):this.currentState==this.CONFIRMATION&&(this.confirmationView.isValid()?this.onAnswersConfirmed():this.showError(this.confirmationInvalidErrorType))},e.prototype.onPrevButtonClick=function(){var t=this.persons.getIterator();new NavigateToPrevPageDetector(t).detect(this.currentState)?this.navigateTo(this.prevPage):this.prevPerson()},e.prototype.prevPerson=function(){this.dropCompleteForEachPerson(),this.hideConfirmation(),this.hideQuestions(),this.hideError(),this.currentPerson=this.getUncompletePerson(),this.onCurrentPersonChanged()},e.prototype.dropCompleteForEachPerson=function(){for(var t=this.persons.getIterator();t.hasNext();)t.next().setIsComplete(!1)},e.prototype.onQuestionsAnswerValid=function(){this.hideQuestions(),this.currentState=this.CONFIRMATION,this.onStateChanged()},e.prototype.onAnswersConfirmed=function(){this.hideConfirmation(),this.currentPerson.setIsComplete(!0),this.currentPerson=this.getUncompletePerson(),this.onCurrentPersonChanged()},e.prototype.navigateTo=function(t){console.log("navigate to "+t),"/medicalissusselectionpage"==t&&(this.$j("#confirmationHeaderContainer").text("Please wait..."),this.$j("#personDetailsContainer").hide(),this.$j("#nextButton").hide(),this.$j("#prevButton").hide()),NavigatorUtil.navigateTo(t)},e.prototype.getCompany=function(){var t=Cookie.getSelectedCompanyData();return StringUtils.parseURI(t)},e.prototype.parseCompany=function(t){this.companyId=t.companyId},e.prototype.hideError=function(){this.errorView&&this.errorView.destroy()},e.prototype.showError=function(t){this.errorView=new PersonDetailsErrorView(this.$j("#userPersonalDataErrorText")),"answerInvalid"==t?this.errorView.showAnswerError():"confirmationInvalid"==t&&this.errorView.showConfirmationError()},e}(BasePage),CardDetailsConfirmationView=function(){function t(t){this.$j=jQuery.noConflict(),this.card=t,this.checkBox=this.$j("#confirmCheckBox"),this.update(),this.uncheckCheckBox()}return t.prototype.update=function(){this.$j("#cardTypeConfirmation").text(this.card.getType()),this.$j("#cardNumberConfirmation").text(this.card.getNumber()),this.$j("#cardholderConfirmation").text(this.card.getHolderName()),this.$j("#cardExpConfirmation").text(this.card.getExpDate())},t.prototype.destroy=function(){this.$j("#cardTypeConfirmation").text(""),this.$j("#cardNumberConfirmation").text(""),this.$j("#cardholderConfirmation").text(""),this.$j("#cardExpConfirmation").text(""),this.uncheckCheckBox()},t.prototype.isConfirmed=function(){return this.checkBox.is(":checked")},t.prototype.uncheckCheckBox=function(){this.checkBox.prop("checked",!1)},t}(),MedIssuesSelectionPage=function(){function t(){this.prevPage="person-details",this.nextPage="finish-application",console.log("MedIssuesSelectionPage"),this.$j=jQuery.noConflict()}return t.prototype.create=function(){this.finishButton=this.$j("#finishButton"),this.prevButton=this.$j("#prevButton"),this.createButtonsListener(),this.createRadioGroupListener(),this.updateApplicationType("NORMAL"),this.updateApplicationIdContainer()},t.prototype.createRadioGroupListener=function(){var t=this;this.$j("input[type=radio][name=medIssuesRadioGroup]").change(function(e){return t.onRadioGroupChanged(e)})},t.prototype.onRadioGroupChanged=function(t){this.selectedOption=parseInt(this.$j(t.target).val()),this.onOptionChanged()},t.prototype.onOptionChanged=function(){0==this.selectedOption?(this.finishButton.hide(),this.$j("#paypalButtonContainer").show(),this.updateApplicationType("NORMAL")):(this.finishButton.show(),this.$j("#paypalButtonContainer").hide(),this.finishButton.text("Finish"),this.updateApplicationType("MEDICAL_ISSUES"))},t.prototype.createButtonsListener=function(){var t=this;this.finishButton.click(function(){return t.onFinishButtonClick()}),this.prevButton.click(function(){return t.onPrevButtonClick()})},t.prototype.onFinishButtonClick=function(){1==this.selectedOption&&this.navigateToNextPage()},t.prototype.onPrevButtonClick=function(){this.navigateToPrevPage()},t.prototype.navigateToPrevPage=function(){NavigatorUtil.navigateTo(this.prevPage)},t.prototype.navigateToNextPage=function(){NavigatorUtil.navigateTo(this.nextPage)},t.prototype.updateApplicationIdContainer=function(){this.$j("#applicationIdContainer").text(Cookie.getQuoteId())},t.prototype.updateApplicationType=function(t){console.log("updateApplicationType "+t),Cookie.setApplicationType(t)},t}(),CardDetailsPage=function(){function t(){this.cardIdMinCharacters=15,this.cardIdMaxCharacters=16,this.prevPage="person-details",this.NORMAL="NORMAL",this.CONFIRMATION="CONFIRMATION",this.CONFIRMED="CONFIRMED",this.$j=jQuery.noConflict(),this.card=new Card,this.card.setType("mastercard"),this.currentState=this.NORMAL}return t.prototype.create=function(){this.cardTypeSelect=this.$j("#cardTypeSelect"),this.cardHolderInput=this.$j("#cardholderNameInput"),this.cardExpirationDateInput=this.$j("#expirationDateInput"),this.cardNumberInput=this.$j("#cardNumberInput"),this.nextButton=this.$j("#nextButton"),this.prevButton=this.$j("#prevButton"),this.errorContainer=this.$j("#errorText"),this.confirmationContainer=this.$j("#confirmationViewContainer"),this.form=this.$j("#cardDetailsForm"),""!=this.cardExpirationDateInput.val()&&this.card.setExpDate(this.cardExpirationDateInput.val()),this.card.setType("mastercard"),this.createCardTypeSelectListener(),this.createCardNumberInputListener(),this.createDateSelector(),this.createButtonsListener()},t.prototype.onStateChanged=function(){this.currentState==this.NORMAL?(this.hideConfirmation(),this.showForm()):this.currentState==this.CONFIRMATION?(this.hideForm(),this.showConfirmation()):this.navigateToNextPage()},t.prototype.showConfirmation=function(){this.$j("#confirmationViewContainer").removeClass("hidden"),this.confirmationView=new CardDetailsConfirmationView(this.card)},t.prototype.hideConfirmation=function(){this.$j("#confirmationViewContainer").addClass("hidden"),this.confirmationView&&(this.confirmationView.destroy(),this.confirmationView=null)},t.prototype.onNextButtonClick=function(){this.hideError();this.currentState==this.NORMAL?(this.cardHolderName=this.cardHolderInput.val(),this.cardExpirationDate=this.cardExpirationDateInput.val(),this.cardNumber=this.cardNumberInput.val(),this.card.setNumber(this.cardNumber),this.card.setHolderName(this.cardHolderName),this.validate()&&(this.currentState=this.CONFIRMATION,this.onStateChanged())):this.currentState==this.CONFIRMATION&&this.validate()&&(this.currentState=this.CONFIRMED,this.onStateChanged())},t.prototype.onPrevButtonClick=function(){this.currentState==this.CONFIRMATION?(this.currentState=this.NORMAL,this.onStateChanged()):this.currentState==this.NORMAL&&this.navigateToPrevPage()},t.prototype.hideError=function(){this.errorContainer.text(""),this.errorContainer.addClass("hidden")},t.prototype.showError=function(t){this.errorContainer.text(t),this.errorContainer.removeClass("hidden")},t.prototype.navigateToNextPage=function(){this.form.submit()},t.prototype.navigateToPrevPage=function(){NavigatorUtil.navigateTo(this.prevPage)},t.prototype.onExpirationDateSelected=function(t){this.cardExpirationDate=this.cardExpirationDateInput.val(),this.card.setExpDate(this.cardExpirationDate)},t.prototype.createButtonsListener=function(){var t=this;this.nextButton.click(function(){return t.onNextButtonClick()}),this.prevButton.click(function(){return t.onPrevButtonClick()})},t.prototype.validate=function(){return this.currentState==this.NORMAL?this.validateInfo():this.currentState==this.CONFIRMATION?this.validateConfirmation():void 0},t.prototype.validateInfo=function(){var t=!0;this.cardHolderName.length<3&&(this.showError("Card holder name invalid"),t=!1);var e=parseInt(this.cardNumberInput.attr("maxlength"));return e!=this.cardNumber.length&&(this.showError("Card number invalid"),t=!1),e!=this.cardNumber.length&&(this.showError("Card number invalid"),t=!1),this.cardExpirationDate.length<1&&(this.showError("Card expiration date invalid"),t=!1),t},t.prototype.validateConfirmation=function(){console.log("validateConfirmation ");var t=this.confirmationView.isConfirmed();return 0==t&&this.showError("Error. You must confirm card details."),t},t.prototype.clearCardIdInput=function(){this.cardNumberInput.val("")},t.prototype.createCardNumberInputListener=function(){var t=this;this.cardNumberInput.keypress(function(e){return t.onCardNumberChanged(e)})},t.prototype.onCardNumberChanged=function(t){if(8!=t.which&&0!=t.which&&(t.which<48||t.which>57))return this.onCardNumberError(),!1},t.prototype.createCardTypeSelectListener=function(){var t=this;this.cardTypeSelect.change(function(){return t.onCardTypeSelectChanged()})},t.prototype.onCardTypeSelectChanged=function(){switch(this.cardType=this.cardTypeSelect.val(),this.card.setType(this.cardType),this.$j("#cardTypeFormData").val(this.cardType),this.clearCardIdInput(),this.cardType){case"mastercard":case"visa":this.cardNumberInput.attr("maxlength",this.cardIdMaxCharacters);break;case"americanExpress":this.cardNumberInput.attr("maxlength",this.cardIdMinCharacters)}},t.prototype.createDateSelector=function(){var t=this;this.cardExpirationDateInput.datepicker({minDate:0,changeMonth:!0,changeYear:!0,yearRange:"-10:+10",dateFormat:"MM yy",defaultDate:new Date,showButtonPanel:!0,onSelect:function(e){return t.onExpirationDateSelected(e)},onClose:function(e,n){return t.onCloseDatepicker(e,n)}});this.cardExpirationDateInput.click(function(){return t.onDateClicked()}),this.cardExpirationDateInput.focus(function(){return t.onDateClicked()})},t.prototype.onCloseDatepicker=function(t,e){var n=this.$j("#ui-datepicker-div .ui-datepicker-month :selected").val(),i=this.$j("#ui-datepicker-div .ui-datepicker-year :selected").val();this.cardExpirationDateInput.val(this.$j.datepicker.formatDate("MM yy",new Date(i,n,1))),this.cardExpirationDate=this.cardExpirationDateInput.val(),this.card.setExpDate(this.cardExpirationDate)},t.prototype.onDateClicked=function(){this.$j("table.ui-datepicker-calendar").eq(2).prop("style","display: none;"),this.$j("table.ui-datepicker-calendar").hide(),this.$j("#ui-datepicker-div").position({my:"center top",at:"center bottom",of:this.cardExpirationDateInput})},t.prototype.hideForm=function(){this.form.addClass("hidden")},t.prototype.showForm=function(){this.form.removeClass("hidden")},t.prototype.onCardNumberError=function(){this.$j("#errmsg").html("Digits Only").show().fadeOut("slow")},t}(),NavigateToPrevPageDetector=function(){function t(t){this.personsIterator=t}return t.prototype.detect=function(t){for(;this.personsIterator.hasNext();)if(this.personsIterator.next().getIsComplete())return!1;return"CONFIRMATION"!=t},t}(),UserInputFormPage=function(){function t(){return Math.round(999999*Math.random())}jQuery.noConflict();return{create:function(e){var n=(new BenefitsJsonDataParser).parse(e);(new AgesSelection).init(),(new AgeInputRow).init(),(new NumPersons).init(),(new StartDateCalendar).init(),(new FinishDateCalendar).init(),(new CountriesSelect).init(),(new UseSccc).init(),(new UserDataInputForm).init(n);var i=t();Cookie.setQuoteId(i)}}},BenefitSelectionPage=function(){function t(){o=new QuotePersonCollection;for(var t=0;t<r.ages.length;t++){var e=r.ages[t],n=new QuotePerson(e);n.setIsUseSCCC(a),n.setPeriod(r.totalDays),0==t&&n.setRelationship(PRIMARY),o.add(n)}}function e(){var t=o.getData();Cookie.setPersons(t)}function n(){var t=r.totalDays;Cookie.setPeriod(t)}function i(t){Cookie.setBenefit(t),c.submit()}var o,r,a,s,c;jQuery.noConflict();return{create:function(){EventBus.addEventListener("BENEFIT_SELECTED",i);var o=Cookie.getUserInputFormData();(r=StringUtils.parseURI(o))||(r={benefit:null}),s=r.benefit,a="Yes"==r.useSccc,t(),e(),n(),c=new BenefitSelectionFormTS(s,"selectedBenefitInput","benefitSelectionForm","benefitsSelectionTable")}}},CompanyPlanSelectionPage=function(){function t(){this.nextPage="/application-creation",this.$j=jQuery.noConflict()}return t.prototype.create=function(){var t=this,e=this.getCompany(),n=new MapJsonDecoder(e.deductiblesCosts);this.companyCosts=n.decode(),this.createCostSelectionForm(),EventBus.addEventListener("COMPANY_PLAN_SELECTED",function(e){return t.companyPlanSelectedHandler(e)})},t.prototype.navigateToNextPage=function(){NavigatorUtil.navigateTo(this.nextPage)},t.prototype.getCompany=function(){var t=Cookie.getSelectedCompanyData();return StringUtils.parseURI(t)},t.prototype.saveSelectedPlan=function(t,e){Cookie.setCompanyPlan(JSON.stringify({deductible:t,cost:e}))},t.prototype.createCostSelectionForm=function(){var t=Cookie.getCompanyPlan(),e=StringUtils.parseURI(t),n=-1;e&&(n=e.deductible);new CompanyPlanSelectionForm(n,"selectedPlanInput","planSelectionForm","planSelectionTable")},t.prototype.companyPlanSelectedHandler=function(t){var e=t.deductible,n=this.companyCosts.get(e);this.saveSelectedPlan(e,n),this.navigateToNextPage()},t}(),PersonsAdditionalDataRequestView=function(){function t(){this.$j=jQuery.noConflict(),this.createChildren(),this.createListeners(),this.savedCountryOfOrigin||this.saveCountryOfOrigin(),this.savedVisitorType||this.saveVisitorType(),this.savedProvince||this.saveProvince(),this.savedArrivalDate||(this.savedArrivalDate=this.arrivalDateControl.val(),this.saveArrivalDate(this.savedArrivalDate))}return t.prototype.validate=function(){var t,e=!0,n=this.arrivalDateControl.val(),i=(this.sponsorFirstNameControl.val(),this.sponsorLastNameControl.val(),this.addressControl.val()),o=this.cityControl.val(),r=this.postalCodeControl.val(),a=this.emailControl.val(),s=this.validateEmail(a),c=this.phoneControl.val(),u=this.validatePhone(c),d=PostalCodeValidator.validate(r);return(!n||n.length<3)&&(t="Arrival date invalid",e=!1),(!i||i.length<3)&&(t="Canadian address invalid",e=!1),(!o||o.length<3)&&(t="City invalid",e=!1),d||(t="Postal code invalid",e=!1),s||(t="Email invalid",e=!1),u||(t="Phone invalid",e=!1),{isValid:e,errorText:t}},t.prototype.loadData=function(){this.savedCountryOfOrigin=Cookie.getCountryOfOrigin(),this.savedVisitorType=Cookie.getVisitorType(),this.savedArrivalDate=Cookie.getArrivalDate(),this.savedSponsorFirstName=Cookie.getSponsorFirstName(),this.savedSponsorLastName=Cookie.getSponsorLastName(),this.savedBeneficiaryFirstName=Cookie.getBeneficiaryFirstName(),this.savedBeneficiaryRelationship=Cookie.getBeneficiaryLastName(),this.savedAddress=Cookie.getAddress(),this.savedProvince=Cookie.getSponsorProvince(),this.savedCity=Cookie.getSponsorCity(),this.savedPostalCode=Cookie.getSponsorPostalCode(),this.savedEmail=Cookie.getEmail(),this.savedPhone=Cookie.getPhone()},t.prototype.createChildren=function(){this.countryOfOriginControl=this.$j("#countriesSelect"),this.visitorTypeControl=this.$j("#visitorTypeSelect"),this.arrivalDateControl=this.$j("#arrivalDateInput"),this.sponsorFirstNameControl=this.$j("#sponsorFirstName"),this.sponsorLastNameControl=this.$j("#sponsorLastName"),this.beneficiaryFirstNameControl=this.$j("#beneficiaryFirstName"),this.beneficiaryRelationship=this.$j("#beneficiaryRelationship"),this.addressControl=this.$j("#streetInput"),this.cityControl=this.$j("#cityInput"),this.provinceControl=this.$j("#provinceSelect"),this.postalCodeControl=this.$j("#postalCodeSelect"),this.emailControl=this.$j("#emailInput"),this.phoneControl=this.$j("#phoneInput"),this.emailErrorMessageElement=this.$j("#emailErrorMessage"),this.phoneErrorMessageElement=this.$j("#phoneErrorMessage"),this.createArrivalDatePicker()},t.prototype.createArrivalDatePicker=function(){var t=this;console.log("createArrivalDatePicker"),console.log("default date: ",new Date),this.arrivalDateControl.datepicker({minDate:0,changeYear:!0,yearRange:"-0:+10",defaultDate:new Date,onSelect:function(e){return t.onArrivalDateSelected(e)}})},t.prototype.updateControls=function(){console.log("update controls this.savedArrivalDate="+this.savedArrivalDate),this.savedCountryOfOrigin&&this.countryOfOriginControl.val(unescape(this.savedCountryOfOrigin)),this.savedVisitorType&&this.visitorTypeControl.val(unescape(this.savedVisitorType)),this.savedArrivalDate&&this.arrivalDateControl.val(this.savedArrivalDate),this.savedSponsorFirstName&&this.sponsorFirstNameControl.val(unescape(this.savedSponsorFirstName)),this.savedSponsorLastName&&this.sponsorLastNameControl.val(unescape(this.savedSponsorLastName)),this.savedBeneficiaryFirstName&&this.beneficiaryFirstNameControl.val(unescape(this.savedBeneficiaryFirstName)),this.savedBeneficiaryRelationship&&this.beneficiaryRelationship.val(unescape(this.savedBeneficiaryRelationship)),this.savedAddress&&this.addressControl.val(unescape(this.savedAddress)),this.savedProvince&&this.provinceControl.val(unescape(this.savedProvince)),this.savedEmail&&this.emailControl.val(unescape(this.savedEmail)),this.savedPhone&&this.phoneControl.val(unescape(this.savedPhone)),this.savedPostalCode&&this.postalCodeControl.val(unescape(this.savedPostalCode)),this.savedCity&&this.cityControl.val(unescape(this.savedCity))},t.prototype.onArrivalDateSelected=function(t){this.saveArrivalDate(t)},t.prototype.createListeners=function(){var t=this;this.countryOfOriginControl.change(function(){return t.countryOfOriginControlChanged()}),this.visitorTypeControl.change(function(){return t.visitorTypeControlChanged()}),this.sponsorFirstNameControl.keyup(function(e){return t.onSponsorFirstNameChanged(e)}),this.sponsorLastNameControl.keyup(function(e){return t.onSponsorLastNameChanged(e)}),this.beneficiaryFirstNameControl.keyup(function(e){return t.onBeneficiaryFirstNameChanged(e)}),this.beneficiaryRelationship.keyup(function(e){return t.onBeneficiaryRelationshipChanged(e)}),this.addressControl.keyup(function(e){return t.onAddressChanged(e)}),this.provinceControl.change(function(){return t.provinceControlChanged()}),this.cityControl.keyup(function(e){return t.cityChanged(e)}),this.postalCodeControl.keyup(function(e){return t.postalCodeChanged(e)}),this.emailControl.keyup(function(e){return t.onEmailChanged(e)}),this.phoneControl.keyup(function(e){return t.onPhoneChanged(e)})},t.prototype.countryOfOriginControlChanged=function(){this.saveCountryOfOrigin()},t.prototype.visitorTypeControlChanged=function(){this.saveVisitorType()},t.prototype.provinceControlChanged=function(){this.saveProvince()},t.prototype.saveCountryOfOrigin=function(){Cookie.setCountryOfOrigin(this.countryOfOriginControl.val())},t.prototype.saveVisitorType=function(){Cookie.setVisitorType(this.visitorTypeControl.val())},t.prototype.saveProvince=function(){Cookie.setSponsorProvince(this.provinceControl.val())},t.prototype.saveArrivalDate=function(t){Cookie.setArrivalDate(t)},t.prototype.onSponsorFirstNameChanged=function(t){Cookie.setSponsorFirstName(this.sponsorFirstNameControl.val())},t.prototype.onSponsorLastNameChanged=function(t){Cookie.setSponsorLastName(this.sponsorLastNameControl.val())},t.prototype.onBeneficiaryFirstNameChanged=function(t){Cookie.setBeneficiaryFirstName(this.beneficiaryFirstNameControl.val())},t.prototype.onBeneficiaryRelationshipChanged=function(t){Cookie.setBeneficiaryLastName(this.beneficiaryRelationship.val())},t.prototype.onAddressChanged=function(t){Cookie.setAddress(this.addressControl.val())},t.prototype.onEmailChanged=function(t){var e=this.emailControl.val();this.validateEmail(e)&&Cookie.setEmail(e)},t.prototype.onPhoneChanged=function(t){var e=this.phoneControl.val();this.validatePhone(e)&&Cookie.setPhone(e)},t.prototype.cityChanged=function(t){Cookie.setSponsorCity(this.cityControl.val())},t.prototype.postalCodeChanged=function(t){Cookie.setSponsorPostalCode(this.postalCodeControl.val())},t.prototype.validateEmail=function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},t.prototype.validatePhone=function(t){return/^\d+$/.test(t)},t.prototype.validatePostalCode=function(t){return PostalCodeValidator.validate(t)},t}(),ApplicationCreationPage=function(t){function e(){t.call(this),this.prevPage="plan-selection",this.nextPage="person-details"}return __extends(e,t),e.prototype.create=function(){var t=this;this.views=new Map("personViews"),this.ages=this.getAges(),this.persons=this.getPersons(),this.updatePersonsMedicalDeclarationRequirements(),this.createChildren(),EventBus.addEventListener("PERSONAL_INFO_VALUE_CHANGED",function(){return t.personalInfoValueChangedHandler()}),EventBus.addEventListener("PERSONAL_INFO_FIRST_NAME_VALIDATE_ERROR",function(e){return t.personalInfoFirstNameValidateErrorHandler(e)}),EventBus.addEventListener("PERSONAL_INFO_LAST_NAME_VALIDATE_ERROR",function(e){return t.personalInfoLastNameValidateErrorHandler(e)}),EventBus.addEventListener("PERSONAL_INFO_BIRTHDAY_VALIDATE_ERROR",function(e){return t.personalInfoBirthdayValidateErrorHandler(e)})},e.prototype.getCompany=function(){var t=Cookie.getSelectedCompanyData();return StringUtils.parseURI(t)},e.prototype.getAges=function(){for(var t=this.$j("#agesCollectionContainer").text(),e=new Array,n=JSON.parse(t),i=0;i<n.length;i++){var o=n[i];e.push(o)}return e},e.prototype.createChildren=function(){var t=this;this.prevButton=this.$j("#prevButton"),this.nextButton=this.$j("#nextButton"),this.prevButton.on("click",function(){return t.prevButtonClickHandler()}),this.nextButton.on("click",function(){return t.nextButtonClickHandler()});for(var e=0;e<this.ages.length;e++){var n=this.persons.getPersonByAge(this.ages[e]),i={age:this.ages[e]};n&&(i.firstName=n.getFirstName(),i.lastName=n.getLastName(),i.gender=n.getGender(),i.relationship=n.getRelationship(),i.birthday=n.getBirthday());var o=new PersonalInfoRequestView(i);this.views.add(this.ages[e].toString(),o)}this.personsAdditionalDataRequestView=new PersonsAdditionalDataRequestView},e.prototype.prevButtonClickHandler=function(){this.navigateToPrevPage()},e.prototype.navigateToNextPage=function(){NavigatorUtil.navigateTo(this.nextPage)},e.prototype.navigateToPrevPage=function(){NavigatorUtil.navigateTo(this.prevPage)},e.prototype.nextButtonClickHandler=function(){this.onNextButtonClick()},e.prototype.onNextButtonClick=function(){this.hideError(),console.log("this.personsAdditionalDataRequestView="+this.personsAdditionalDataRequestView);var t=this.personsAdditionalDataRequestView.validate(),e=t.isValid;if(!e)return this.errorText=t.errorText,void this.onDataInvalid();for(var n=this.views.getIterator();n.hasNext();)if(!(e=n.next().isValid()))return void this.onDataInvalid();this.saveData(),this.navigateToNextPage()},e.prototype.onDataInvalid=function(){this.showError()},e.prototype.personalInfoValueChangedHandler=function(){this.hideError()},e.prototype.hideError=function(){this.$j("#userPersonalDataErrorText").text(""),this.$j("#userPersonalDataErrorText").addClass("hidden");for(var t=this.views.getIterator();t.hasNext();)t.next().dropError()},e.prototype.showError=function(){this.$j("#userPersonalDataErrorText").text(this.errorText),this.$j("#userPersonalDataErrorText").removeClass("hidden")},e.prototype.saveData=function(){for(var t=this.views.getIterator(),e=0;t.hasNext();){var n=t.next().getData(),i=n.age,o=this.persons.getPersonByAge(i);o.setFirstName(n.firstName),o.setLastName(n.lastName),o.setGender(n.gender),o.setBirthday(n.birthday),0==e?o.setRelationship("Primary"):o.setRelationship(n.relationship),e++}Cookie.setPersons(this.persons.getData())},e.prototype.personalInfoFirstNameValidateErrorHandler=function(t){this.errorText="Person with age "+t+" has invalid first name."},e.prototype.personalInfoLastNameValidateErrorHandler=function(t){this.errorText="Person with age "+t+" has invalid last name."},e.prototype.personalInfoBirthdayValidateErrorHandler=function(t){this.errorText="Person with age "+t+" has invalid birthday."},e.prototype.getRateTableGuideData=function(){return this.$j("#companyRateTableGuide").text()},e.prototype.parseRateTableGuide=function(t){return(new RateTableGuideParser).parse(t)},e.prototype.compareFunction=function(t,e){return t>e?-1:1},e.prototype.updatePersonsMedicalDeclarationRequirements=function(){var t=this.getRateTableGuideData(),e=this.parseRateTableGuide(t);new MedicalDeclarationRequirementUpdater(this.persons,e).update()},e}(BasePage),ApplicationFinishPage=function(t){function e(){t.call(this),console.log("Im application finish page"),this.card=this.getCard()}return __extends(e,t),e.prototype.create=function(){this.persons=this.getPersons(),this.companyData=this.getCompany(),this.quoteId=Cookie.getQuoteId(),this.loadQuotePersonsData()},e.prototype.onApplicationSaved=function(){(new SendResultEmailPage).create()},e.prototype.saveApplication=function(){var t=new QuoteSaver,e=Cookie.getPeriod(),n=Cookie.getCompanyPlan(),i=StringUtils.parseURI(n),o=Cookie.getUserInputFormData(),r=StringUtils.parseURI(o),a=r.startDate.date,s=r.finishDate.date;a=a.split("+")[0],s=s.split("+")[0];var c=JSON.stringify({company:this.companyData.companyName,benefit:this.companyData.benefit,period:e,deductible:i.deductible,cost:i.cost,startDate:a,finishDate:s}),u=this.persons.size(),d=Cookie.getCountryOfOrigin(),l=Cookie.getVisitorType(),p=Cookie.getArrivalDate(),h=Cookie.getSponsorFirstName(),f=Cookie.getSponsorLastName(),v=Cookie.getBeneficiaryFirstName(),g=Cookie.getBeneficiaryLastName(),m=Cookie.getAddress(),C=Cookie.getSponsorCity(),y=Cookie.getSponsorProvince(),D=Cookie.getSponsorPostalCode(),b=Cookie.getEmail(),E=Cookie.getPhone(),N=Cookie.getApplicationType();console.log("application type: "+N),this.quoteDataToSave={quoteId:this.quoteId,companyName:this.companyData.companyName,quoteData:c,persons:this.personsData,period:e,numPersons:u,startDate:a,finishDate:s,countryOfOrigin:d,visitorType:l,arrivalDate:p,sponsorFirstName:h,sponsorLastName:f,beneficiaryFirstName:v,beneficiaryLastName:g,address:m,city:C,province:y,postalCode:D,email:b,phone:E,type:N,state:"IN_PROGRESS"},this.$j("#quoteData").val(JSON.stringify(this.quoteDataToSave)),t.save(this.quoteDataToSave)},e.prototype.getCard=function(){var t=new Card;return t.setExpDate(this.$j("#expirationDate").text()),t.setHolderName(this.$j("#cardholderName").text()),t.setNumber(this.$j("#cardNumber").text()),t.setType(this.$j("#cardType").text()),t},e.prototype.decorateQuoteIdWithCurrentDate=function(){var t=new Date,e=(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()),n=t.getMinutes(),i=t.getSeconds();this.quoteId=DateUtils.getCurrentDate()+"__"+e+"-"+n+"-"+i},e.prototype.onPersonsDataValid=function(){this.decorateQuoteIdWithCurrentDate(),this.saveApplication(),this.$j("#quoteDate").text(this.$j("#quoteData").val()),this.onApplicationSaved(),this.deletePersonsTempData()},e.prototype.deletePersonsTempData=function(){DB.deletePersons(this.quoteId)},e.prototype.getCompany=function(){var t=Cookie.getSelectedCompanyData();return StringUtils.parseURI(t)},e.prototype.loadQuotePersonsData=function(){var t=this;EventBus.addEventListener("personsDataLoadComplete",function(e){return t.personsDataLoadComplete(e)}),DB.loadPersons(this.quoteId)},e.prototype.personsDataLoadComplete=function(t){var e=this;EventBus.removeEventListener("personsDataLoadComplete",function(t){return e.personsDataLoadComplete(t)}),this.onPersonDataLoadComplete(t)},e.prototype.onPersonDataLoadComplete=function(t){this.validatePersonsLoadedData(t)?(this.personsData=t,this.onPersonsDataValid()):console.error("persons loaded data not valid. data: "+t)},e.prototype.validatePersonsLoadedData=function(t){var e=unescape(t);try{JSON.parse(e);return!0}catch(t){return!1}},e}(BasePage),SendResultEmailPage=function(){function t(){this.receiver="",this.$j=jQuery.noConflict(),this.emailSender=new EmailSender}return t.prototype.create=function(){var t=this;EventBus.addEventListener("APPLICATION_EMAIL_SENT_RESULT",function(e){return t.onApplicationEmailSentResult(e)}),EventBus.addEventListener("APPLICATION_ADMIN_EMAIL_SENT_RESULT",function(e){return t.onApplicationEmailAdminSentResult(e)}),EventBus.addEventListener("HTML_EXPORT_COMPLETE",function(e){return t.onHTMLExportComplete(e)});var e=this.getQuoteData();this.parseQuoteData(e),this.updateBody(),this.iteratePersons();var n=this.createPersonsShortInfoHTML();console.log(n),this.$j("#personsShortInfoContainer").html(n),this.emailBodyHtml=this.$j("#emailBody").html(),this.emailBodyHtml=this.decorateEmailBody(),this.exportHtml()},t.prototype.exportHtml=function(){(new HTMLExporter).export(this.data.quoteId,this.emailBodyHtml)},t.prototype.onHTMLExportComplete=function(t){console.log("onHTMLExportComplete. result: "+t);var e=JSON.parse(t);this.appId=e.appId;var n=e.url;console.log("applicationHtmlFileUrl="+n),this.emailBody='<b>Thanks</b> for your application. You can download it using this link <p><a href="'+n+'" target="_blank">'+n+"</a></p><p>Best regards</p>",this.sendApplicationAdminEmail()},t.prototype.onApplicationEmailSentResult=function(t){var e=this.$j("<div>"+t+"</div>");e.dialog({modal:!0,buttons:[{text:"Ok",click:function(t){e.dialog("close")}}]})},t.prototype.sendApplicationAdminEmail=function(){console.log("sending application admin email..."),this.emailSender.sendApplicationAdminEmail(this.appId)},t.prototype.sendApplicationResultEmail=function(){this.emailSender.sendApplicationResult(this.receiver,this.emailBody,this.appId)},t.prototype.onApplicationEmailAdminSentResult=function(t){console.log("application admin email send result "+t),this.sendApplicationResultEmail()},t.prototype.decorateEmailBody=function(){return this.emailBodyHtml},t.prototype.getQuoteData=function(){return this.$j("#quoteDate").text()},t.prototype.parseQuoteData=function(t){this.data=JSON.parse(t),this.quoteData=JSON.parse(this.data.quoteData),this.persons=this.getPersons(),this.receiver=unescape(this.data.email)},t.prototype.getPersons=function(){var t=this.data.persons;return new PersonCollectionParser(t).parse()},t.prototype.iteratePersons=function(){for(var t=this.persons.getIterator();t.hasNext();){var e=t.next();new QuotePersonAdminView(e,this.$j("#personsContainer"))}},t.prototype.createPersonsShortInfoHTML=function(){for(var t="<h2><div style='width: 100%; background-color: #d9edf7; text-align: center;'>Insureds</div></h2><table><tbody>",e=this.persons.getIterator();e.hasNext();){var n=e.next(),i="<td style='padding-left: 10px; padding-right: 10px;'>FirstName:</td>";i+="<td style='padding-left: 10px; padding-right: 10px;'><b>"+n.getFirstName()+"</b></td>",i+="<td style='padding-left: 10px; padding-right: 10px;'>Last name:</td>",i+="<td style='padding-left: 10px; padding-right: 10px;'><b>"+n.getLastName()+"</b></td>",i+="<td style='padding-left: 10px; padding-right: 10px;'>Age:</td>",i+="<td style='padding-left: 10px; padding-right: 10px;'><b>"+n.getAge()+"</b></td>",i+="<td style='padding-left: 10px; padding-right: 10px;'>Birthday:</td>",i+="<td style='padding-left: 10px; padding-right: 10px;'><b>"+n.getBirthday()+"</b></td>",i+="<td style='padding-left: 10px; padding-right: 10px;'>Gender:</td>";t+="<tr>"+(i+="<td style='padding-left: 10px; padding-right: 10px;'><b>"+n.getGender()+"</b></td>")+"</tr>"}return t+="</tbody></table>"},t.prototype.updateBody=function(){this.$j("#cardType").text(this.data.address),this.$j("#application").text("Application:   "+this.data.quoteId),this.$j("#company").html("Company: <b>"+unescape(this.data.companyName)+"</b>");var t=StringUtils.formatMoneyInt(this.quoteData.benefit);this.$j("#benefit").html("<b>"+t+"</b>");var e=StringUtils.formatMoneyInt(this.quoteData.deductible);this.$j("#deductible").html("<b>"+e+"</b>");var n=StringUtils.formatDivisionalMoney(this.quoteData.cost);this.$j("#cost").html("<b>"+n+"</b>"),this.$j("#startDate").html("<b>"+this.quoteData.startDate+"</b>"),this.$j("#finishDate").html("<b>"+this.quoteData.finishDate+"</b>"),this.$j("#period").html("<b>"+this.quoteData.period+" day(s)</b>"),this.updateVisitorsInfo()},t.prototype.updateCardInfo=function(){var t=unescape(StringUtils.decorateCardNumber(this.data.cardNumber));this.$j("#cardTypeContainer").html("<b>"+unescape(this.data.cardType)+"</b>"),this.$j("#cardHolder").html("<b>"+unescape(this.data.cardHolderName)+"</b>"),this.$j("#cardNumberContainer").html("<b>"+t+"</b>"),this.$j("#cardExpDate").html("<b>***</b>")},t.prototype.updateVisitorsInfo=function(){this.$j("#countryOfOrigin").html("<b>"+unescape(this.data.countryOfOrigin)+"</b>"),this.$j("#visitorType").html("<b>"+unescape(this.data.visitorType)+"</b>"),this.$j("#arrivalDate").html("<b>"+unescape(this.data.arrivalDate)+"</b>"),this.$j("#sponsorFirstName").html("<b>"+unescape(this.data.sponsorFirstName)+"</b>"),this.$j("#sponsorLastName").html("<b>"+unescape(this.data.sponsorLastName)+"</b>"),this.$j("#beneficiaryFirstName").html("<b>"+unescape(this.data.beneficiaryFirstName)+"</b>"),this.$j("#beneficiaryLastName").html("<b>"+unescape(this.data.beneficiaryLastName)+"</b>"),this.$j("#address").html("<b>"+unescape(this.data.address)+"</b>"),this.$j("#city").html("<b>"+unescape(this.data.city)+"</b>"),this.$j("#province").html("<b>"+unescape(this.data.province)+"</b>"),this.$j("#postalCode").html("<b>"+unescape(this.data.postalCode)+"</b>"),this.$j("#email").html("<b>"+unescape(this.data.email)+"</b>"),this.$j("#phone").html("<b>"+unescape(this.data.phone)+"</b>")},t}(),$=jQuery.noConflict(),companyFamilyRateMinNumPersons=3;$(document).ready(function(t){console.log("FrontendInit");t(window),t(".navbar"),t("body");t.datepicker.setDefaults({dateFormat:"yy-mm-dd"});var e=(new GetCompaniesBenefitsDataJson).execute(),n="simplePage"==t("#pageType").text(),i=t("#pageType").text(),o=PageFactory.create(i);o&&(n?o.create(e):o.create())});